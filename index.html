<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sori - Learn Korean by Sound</title>
  <meta name="theme-color" content="#7c3aed"/>

  <style>
    :root{
      --purple:#7c3aed; --purple-d:#6d28d9;
      --pink:#e11d48;  --muted:#6b7280; --ink:#1f2937;
      --chip:#e5e7eb;  --bg:#faf8ff;
    }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;max-width:680px;margin:0 auto;padding:12px;background:var(--bg)}
    h1{font-size:24px;font-weight:800;color:var(--purple);margin:0 0 4px}
    .intro{font-size:12px;color:#9ca3af;margin-bottom:10px}

    .header{display:flex;justify-content:space-between;align-items:center}
    .top-btn{padding:6px 12px;border-radius:10px;border:0;background:var(--purple);color:#fff;font-weight:800;cursor:pointer}

    .card{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.05);padding:16px;margin:8px 0}

    /* tabs (기존 방식 유지) */
    .tabs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px}
    .tab{padding:12px 0;border-radius:12px;background:#f4f0ff;color:var(--purple-d);font-weight:800;text-align:center;cursor:pointer}
    .tab.active{background:var(--purple);color:#fff}
    .saved{padding:10px 14px;border:2px solid #e9defd;background:#fff;color:var(--purple);border-radius:12px;font-weight:800;cursor:pointer;white-space:nowrap}

    /* sub chips */
    .sub-filters{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .sub-chip{padding:6px 12px;border-radius:14px;border:2px solid var(--chip);background:#fff;font-size:12px;font-weight:600;color:#374151;cursor:pointer}
    .sub-chip.active{background:var(--purple);border-color:var(--purple);color:#fff}

    .row-between{display:flex;justify-content:space-between;align-items:center}
    .badge{background:var(--purple);color:#fff;font-size:11px;font-weight:800;border-radius:10px;padding:5px 10px}
    .icon-btn{border:0;background:transparent;color:#9ca3af;width:32px;height:32px;border-radius:8px;font-size:20px;cursor:pointer}
    .icon-btn.active{color:var(--pink)}

    /* text layout */
    .meaning{color:var(--muted);font-size:16px;text-align:center;margin:6px 0 2px;font-style:italic}
    .kbox{background:#f9fafb;border-radius:14px;padding:14px 10px;margin:6px 0 10px;text-align:center}
    .ko{font-size:28px;font-weight:900;color:var(--ink);margin:4px 0 6px}
    .roman{color:var(--muted);font-size:16px;margin:0 0 6px;font-weight:600}

    .practice{background:#f9fafb;border-radius:10px;padding:10px}
    .practice-label{font-size:12px;color:var(--muted);text-align:center;margin:0 0 6px;font-weight:600}
    .dots{display:flex;gap:6px;justify-content:center;margin-bottom:6px}
    .rep-dot{width:32px;height:32px;border-radius:50%;border:2px solid #e5e7eb;background:#fff}
    .rep-dot.completed{background:var(--purple);border-color:var(--purple)}

    .big{width:100%;padding:12px 18px;border-radius:14px;border:0;background:var(--purple);color:#fff;font-weight:800}
    .row{display:flex;align-items:center;justify-content:center;gap:8px;background:#f9fafb;border-radius:8px;padding:8px;margin-top:8px}
    .row label,.row span{color:var(--purple);font-size:12px;font-weight:700}
    .row input[type="range"]{accent-color:var(--pink)} /* 슬라이더 = 별색 */

    .nav{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .secondary{background:#f9fafb;border:0;border-radius:14px;padding:12px 18px;font-weight:800}
    .progress{text-align:center;color:var(--purple);font-weight:800;font-size:13px;margin-top:6px}

    .tip{margin-top:10px;background:#fff1f2;border-left:3px solid var(--pink);border-radius:10px;padding:10px;color:#9f1239;font-size:12px;font-weight:600}

    /* hidden legacy tabs for app.js */
    .hidden-tabs{display:none}
  </style>
</head>
<body>
  <!-- header -->
  <header class="header">
    <div>
      <h1>Sori <span style="font-size:14px;color:#9ca3af;font-weight:600;">(beta)</span></h1>
      <div class="intro">Learn Korean naturally by repeating real sounds</div>
    </div>
    <button id="loginBtn" class="top-btn">Login</button>
  </header>

  <!-- category -->
  <section class="card">
    <div class="tabs">
      <button id="dailyBtn"  class="tab active">Daily</button>
      <button id="travelBtn" class="tab">Travel</button>
      <button id="dramaBtn"  class="tab">K-Drama</button>
    </div>
    <button id="savedBtn" class="saved">★ Saved</button>

    <div id="subFilters" class="sub-filters"></div>

    <!-- 숨김: 기존 app.js 호환용 -->
    <div class="hidden-tabs">
      <button id="savedBtnHidden">Saved</button>
    </div>
  </section>

  <!-- lesson -->
  <section class="card">
    <div class="row-between">
      <div id="badge" class="badge">Greeting</div>
      <button id="scrapBtn" class="icon-btn" title="Save">☆</button>
    </div>

    <!-- 위: 영어 뜻 / 아래: 발음 (tight) -->
    <p id="meaningText" class="meaning">"Hello"</p>

    <div class="kbox">
      <p id="korean" class="ko">안녕하세요.</p>
      <p id="roman"  class="roman">annyeonghaseyo</p>

      <!-- 원래 파일에서 넘어오는 기존 자리(숨김) -->
      <p id="english" style="display:none">Hello</p>
      <p id="pronunciation" style="display:none">annyeonghaseyo</p>
    </div>

    <div class="practice">
      <p class="practice-label">Practice Count: <span id="repCount">0</span> / 5</p>
      <div class="dots"><div class="rep-dot"></div><div class="rep-dot"></div><div class="rep-dot"></div><div class="rep-dot"></div><div class="rep-dot"></div></div>
    </div>

    <button id="playBtn" class="big">Listen & Repeat</button>

    <div class="row">
      <label for="speed">Speed:</label>
      <input id="speed" type="range" min="0.3" max="1.0" step="0.1" value="0.75" />
      <span id="speedTxt">0.75x</span>
    </div>

    <div id="tip" class="tip">Tip: Listen carefully and repeat multiple times. Consistency is key.</div>
  </section>

  <!-- nav -->
  <section class="card">
    <div class="nav">
      <button id="prevBtn" class="secondary">◀ Previous</button>
      <button id="nextBtn" class="secondary">▶ Next</button>
    </div>
    <div id="prog" class="progress">1 / 45</div>
  </section>

  <!-- ===== Scripts (데이터/앱은 기존 파일 그대로 사용) ===== -->
  <script defer src="data/daily.js?v=20251017"></script>
  <script defer src="data/travel.js?v=20251017"></script>
  <script defer src="data/drama.js?v=20251017"></script>
  <script defer src="data/dataindex.js?v=20251017"></script>

  <script defer src="js/state.js?v=20251017"></script>
  <script defer src="js/tts.js?v=20251017"></script>
  <script defer src="js/app.js?v=20251017"></script>

  <!-- 최소한의 배치(무한 감시 없음) -->
  <script>
    (function(){
      const $ = id => document.getElementById(id);
      const setTxt = (el, txt) => { if(el && el.textContent !== txt) el.textContent = txt; };

      function applyLayoutOnce(){
        const ko = ($('korean')?.textContent || '').trim();
        const en = ($('english')?.textContent || '').trim();     // 영어 뜻 원본
        const pr = ($('pronunciation')?.textContent || '').trim();// 발음 원본

        if(ko){
          if(en) setTxt($('meaningText'), `"${en.replace(/^"+|"+$/g,'')}"`);
          if(pr) setTxt($('roman'), pr);
        }
      }

      // 최초 1회 적용
      document.addEventListener('DOMContentLoaded', applyLayoutOnce);

      // 카테고리/서브칩/이전/다음 눌렀을 때만 1회 보정
      ['dailyBtn','travelBtn','dramaBtn','savedBtnHidden','subFilters','prevBtn','nextBtn']
        .forEach(id=>{
          const el = document.getElementById(id);
          el && el.addEventListener('click', ()=> setTimeout(applyLayoutOnce, 0), true);
        });

      // Saved 버튼은 기존 숨김 버튼으로 위임
      $('savedBtn')?.addEventListener('click', ()=> $('savedBtnHidden')?.click());

      // 슬라이더 텍스트
      const speed = $('speed'), speedTxt = $('speedTxt');
      speed?.addEventListener('input', ()=> speedTxt.textContent = Number(speed.value).toFixed(2)+'x');
    })();
  </script>
</body>
</html>
