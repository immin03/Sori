<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sori - Learn Korean</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
  * { box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 680px; margin: 0 auto; padding: 12px; background: #faf8ff; min-height: 100vh; }
  h1 { font-size: 24px; margin: 0 0 4px 0; color: #7c3aed; font-weight: 800; }
  .intro { color: #9ca3af; font-size: 12px; margin-bottom: 10px; line-height: 1.3; font-weight: 500; }
  .card { border-radius: 16px; padding: 16px; margin: 8px 0; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04); background: white; }
  .category-tabs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 8px; }
  .tab-button { padding: 10px 14px; border: 2px solid #f3f4f6; border-radius: 14px; background: #f9fafb; color: #9ca3af; cursor: pointer; font-size: 13px; font-weight: 700; transition: all 0.2s; }
  .tab-button:hover { background: #f3f4f6; }
  .tab-button.active { background: #7c3aed; color: white; border-color: #7c3aed; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2); }
  .sub-filters { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 8px; padding: 10px; background: #f9fafb; border-radius: 10px; }
  .filter-chip { padding: 5px 10px; border-radius: 14px; background: white; border: 2px solid #e5e7eb; color: #6b7280; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; }
  .filter-chip:hover { background: #f9fafb; }
  .filter-chip.active { background: #7c3aed; color: white; border-color: #7c3aed; }
  .badge { display: inline-block; background: #7c3aed; color: white; padding: 5px 10px; border-radius: 10px; font-size: 11px; font-weight: 800; margin-bottom: 5px; }
  .context-box { background: #f9fafb; border-radius: 8px; padding: 6px 10px; margin-bottom: 10px; font-size: 12px; color: #6b7280; font-weight: 600; }
  .korean-section { background: #f9fafb; border-radius: 14px; padding: 16px 12px; margin: 8px 0; }
  .target-display { font-size: 28px; font-weight: 900; color: #1f2937; text-align: center; line-height: 1.2; margin-bottom: 6px; }
  .english-translation { color: #6b7280; font-size: 16px; text-align: center; margin-bottom: 10px; font-weight: 600; }
  .pronunciation-hint { color: #9ca3af; font-size: 13px; font-weight: 600; text-align: center; letter-spacing: 0.3px; margin-bottom: 0; font-style: italic; }
  .pronunciation-section { display: none; }
  button { padding: 12px 18px; border: 0; border-radius: 14px; background: #7c3aed; color: white; cursor: pointer; font-size: 15px; font-weight: 800; width: 100%; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2); transition: all 0.2s; }
  button:hover { background: #6d28d9; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.25); }
  button:disabled { opacity: 0.4; cursor: not-allowed; }
  button.secondary { background: #f9fafb; color: #6b7280; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); }
  button.secondary:hover { background: #f3f4f6; }
  .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 8px; }
  .practice-tip { background: #fffbeb; border-left: 3px solid #f59e0b; padding: 8px 12px; border-radius: 10px; margin-top: 8px; font-size: 12px; color: #92400e; line-height: 1.4; font-weight: 500; }
  .repetition-tracker { margin: 8px 0; padding: 10px; background: #f9fafb; border-radius: 10px; }
  .repetition-label { font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-align: center; }
  .repetition-dots { display: flex; gap: 5px; justify-content: center; margin-bottom: 8px; }
  .rep-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #e5e7eb; background: white; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.3s; }
  .rep-dot.completed { background: #7c3aed; border-color: #7c3aed; transform: scale(1.1); }
  .congratulations { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 12px; border-radius: 10px; text-align: center; margin: 8px 0; display: none; animation: slideIn 0.5s ease-out; }
  .congratulations.show { display: block; }
  .congratulations-emoji { font-size: 36px; margin-bottom: 4px; }
  .congratulations-text { font-size: 16px; font-weight: 800; color: #92400e; margin-bottom: 2px; }
  .congratulations-subtext { font-size: 12px; color: #92400e; font-weight: 600; }
  @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  .progress { text-align: center; color: #7c3aed; font-size: 13px; font-weight: 700; margin-top: 8px; }
  .voice-speed { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 8px; }
  .voice-speed label { color: #7c3aed; font-size: 12px; font-weight: 600; }
  .voice-speed input { width: 110px; cursor: pointer; }
  .voice-speed input[type="range"] { -webkit-appearance: none; appearance: none; height: 5px; background: #e5e7eb; border-radius: 10px; outline: none; }
  .voice-speed input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #7c3aed; border-radius: 50%; cursor: pointer; transition: all 0.2s; }
  .voice-speed input[type="range"]::-webkit-slider-thumb:hover { background: #6d28d9; transform: scale(1.1); }
  .voice-speed input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: #7c3aed; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; }
  .voice-speed input[type="range"]::-moz-range-thumb:hover { background: #6d28d9; transform: scale(1.1); }
  .voice-speed span { color: #7c3aed; font-weight: 700; font-size: 12px; min-width: 45px; }
  .error-msg { background: #fee2e2; color: #991b1b; padding: 8px 12px; border-radius: 8px; margin-top: 8px; font-size: 11px; font-weight: 600; display: none; }
  @media (max-width: 640px) { body { padding: 12px; } h1 { font-size: 24px; } .card { padding: 16px; } .target-display { font-size: 28px; } .pronunciation-hint { font-size: 15px; } .category-tabs { grid-template-columns: 1fr; } }
  .auth-section { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
  .auth-section:not(.hidden) { display: flex; }
  .header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; position: relative; z-index: 1; }
  .header-left { flex: 1; }
  .header-right { display: flex; gap: 8px; }
  .login-btn { background: #7c3aed; color: white; border: none; padding: 8px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
  .login-btn:hover { background: #6d28d9; }
  .my-btn { background: #f9fafb; color: #6b7280; border: 2px solid #e5e7eb; padding: 8px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
  .my-btn:hover { background: #f3f4f6; }
  .auth-section.hidden { display: none; }
  .auth-card { background: white; padding: 40px; border-radius: 24px; text-align: center; max-width: 400px; width: 100%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); position: relative; pointer-events: auto; }
  .auth-close { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 28px; color: #9ca3af; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; line-height: 1; padding: 0; }
  .auth-close:hover { background: #f3f4f6; color: #6b7280; }
  .auth-title { font-size: 28px; font-weight: 800; color: #7c3aed; margin-bottom: 8px; }
  .auth-subtitle { font-size: 14px; color: #9ca3af; margin-bottom: 24px; }
  .google-login-btn { background: white; border: 2px solid #e5e7eb; padding: 14px 24px; border-radius: 12px; font-size: 16px; font-weight: 600; color: #1f2937; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 12px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); pointer-events: auto; user-select: none; }
  .google-login-btn svg { pointer-events: none; }
  .google-login-btn:hover { background: #f9fafb; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transform: translateY(-1px); }
  .google-login-btn:active { transform: translateY(0); background: #f3f4f6; }
  .user-profile { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); }
  .user-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #7c3aed; }
  .user-info { flex: 1; text-align: left; }
  .user-name { font-size: 13px; font-weight: 700; color: #1f2937; }
  .user-level { font-size: 11px; color: #7c3aed; font-weight: 600; }
  .logout-btn { background: #f9fafb; border: none; padding: 6px 10px; border-radius: 8px; font-size: 11px; font-weight: 600; color: #6b7280; cursor: pointer; }
  .logout-btn:hover { background: #f3f4f6; }
  .stats-card { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 8px; }
  .stat-item { background: #f9fafb; padding: 10px; border-radius: 10px; text-align: center; }
  .stat-value { font-size: 18px; font-weight: 800; color: #7c3aed; }
  .stat-label { font-size: 10px; color: #6b7280; font-weight: 600; margin-top: 3px; }
</style>
</head>
<body>
  <!-- Header -->
  <div class="header-container">
    <div class="header-left">
      <h1>Sori <span style="font-size: 14px; color: #9ca3af; font-weight: 600;">(beta)</span></h1>
      <div class="intro">Master Korean with K-Drama lines and daily conversations üíï</div>
    </div>
  </div>

  <div class="card">
    <div class="category-tabs">
      <button class="tab-button active" id="dailyBtn">üí¨ Daily</button>
      <button class="tab-button" id="travelBtn">‚úàÔ∏è Travel</button>
      <button class="tab-button" id="dramaBtn">üé≠ K-Drama</button>
    </div>
    <div id="subFilters" style="display:none;"></div>
  </div>

  <div class="card">
    <div class="badge" id="badge">Greeting</div>
    <div class="context-box" id="context">Conversation: First meeting</div>

    <div class="korean-section">
      <div class="target-display" id="korean">ÏïàÎÖïÌïòÏÑ∏Ïöî.</div>
      <div class="english-translation" id="english">"Hello"</div>
      <div class="pronunciation-hint" id="pronunciation">annyeonghaseyo</div>
    </div>

    <div class="repetition-tracker">
      <div class="repetition-label">üéØ Practice Count: <span id="repCount">0</span> / 5</div>
      <div class="repetition-dots" id="repDots">
        <div class="rep-dot" id="dot1"></div>
        <div class="rep-dot" id="dot2"></div>
        <div class="rep-dot" id="dot3"></div>
        <div class="rep-dot" id="dot4"></div>
        <div class="rep-dot" id="dot5"></div>
      </div>
    </div>

    <div class="congratulations" id="congrats">
      <div class="congratulations-emoji">üéâ</div>
      <div class="congratulations-text">Ï∞∏ ÏûòÌñàÏñ¥Ïöî!</div>
      <div class="congratulations-subtext">Great job! Ready for the next one?</div>
    </div>

    <button id="playBtn">üîä Listen & Repeat</button>
    <div class="error-msg" id="errorMsg"></div>

    <div class="voice-speed">
      <label>Speed:</label>
      <input type="range" id="speed" min="0.3" max="1.0" step="0.1" value="0.75">
      <span id="speedTxt">0.75x</span>
    </div>

    <div class="practice-tip">
      üí° <strong>Tip:</strong> Listen carefully and repeat multiple times. Consistency is key!
    </div>
  </div>

  <div class="card">
    <div class="button-group">
      <button class="secondary" id="prevBtn">‚óÄ Previous</button>
      <button class="secondary" id="nextBtn">‚ñ∂ Next</button>
    </div>
    <div class="progress" id="prog">1 / 30</div>
  </div>

<script>
// ===================== Firebase (demo-safe) =====================
const firebaseConfig = {
  apiKey: "AIzaSyBXxvK_your_api_key_here",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abcdef"
};

let auth, db, currentUser = null;
let firebaseInitialized = false;

console.log('Attempting Firebase initialization...');
try {
  if (typeof firebase !== 'undefined') {
    firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
    firebaseInitialized = true;
    console.log('‚úÖ Firebase initialized successfully');
  } else {
    console.log('‚ö†Ô∏è Firebase SDK not loaded');
  }
} catch (e) {
  console.log('‚ö†Ô∏è Firebase initialization skipped - demo mode:', e.message);
}

// ===================== User State =====================
const userState = {
  uid: null, name: null, email: null, photoURL: null,
  level: 1, xp: 0, totalDays: 0, streak: 0, lastVisit: null,
  practiceCount: {}
};

function calculateLevel(xp) {
  if (xp < 100) return 1;
  if (xp < 300) return 2;
  if (xp < 600) return 3;
  if (xp < 1000) return 4;
  if (xp < 1500) return 5;
  return Math.floor(xp / 300) + 1;
}
function getLevelName(level) {
  const levels = ['Beginner','Elementary','Intermediate','Advanced','Expert','Master'];
  return levels[Math.min(level - 1, levels.length - 1)] || 'Master';
}

async function checkAndUpdateAttendance() {
  if (!currentUser || !db) return;
  const today = new Date().toDateString();
  const yesterday = new Date(Date.now() - 86400000).toDateString();
  if (userState.lastVisit !== today) {
    const isConsecutive = userState.lastVisit === yesterday;
    userState.lastVisit = today;
    userState.totalDays += 1;
    userState.streak = isConsecutive ? userState.streak + 1 : 1;
    userState.xp += 10;
    await db.collection('users').doc(currentUser.uid).set({
      ...userState, updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true });
    updateUserUI();
    showError('üéâ Daily check-in complete! +10 XP');
  }
}

async function loadUserData() {
  if (!currentUser || !db) return;
  try {
    const doc = await db.collection('users').doc(currentUser.uid).get();
    if (doc.exists) {
      const data = doc.data();
      userState.level = data.level || 1;
      userState.xp = data.xp || 0;
      userState.totalDays = data.totalDays || 0;
      userState.streak = data.streak || 0;
      userState.lastVisit = data.lastVisit || null;
      userState.practiceCount = data.practiceCount || {};
    } else {
      userState.lastVisit = new Date().toDateString();
      userState.totalDays = 1;
      userState.streak = 1;
      userState.xp = 10;
      await db.collection('users').doc(currentUser.uid).set({
        ...userState,
        uid: currentUser.uid, email: currentUser.email,
        name: currentUser.displayName, photoURL: currentUser.photoURL,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
    await checkAndUpdateAttendance();
  } catch (error) { console.error('Error loading user data:', error); }
}

function updateUserUI() {
  const nameEl   = document.getElementById('userName');
  const levelEl  = document.getElementById('userLevel');
  const daysEl   = document.getElementById('totalDays');
  const streakEl = document.getElementById('streak');
  const xpEl     = document.getElementById('xpPoints');
  const avatarEl = document.getElementById('userAvatar');
  if (nameEl)  nameEl.textContent  = userState.name || 'User';
  if (levelEl) levelEl.textContent = `Level ${userState.level} - ${getLevelName(userState.level)}`;
  if (daysEl)  daysEl.textContent  = userState.totalDays;
  if (streakEl)streakEl.textContent= userState.streak;
  if (xpEl)    xpEl.textContent    = userState.xp;
  if (avatarEl && userState.photoURL) avatarEl.src = userState.photoURL;
}

// Login helpers (guarded)
window.handleGoogleLogin = function() {
  console.log('üîò Google login button clicked!');
  if (!auth) {
    const authModal = document.getElementById('authModal');
    if (authModal) authModal.classList.add('hidden');
    alert('üîß Demo Mode - Firebase Not Configured\n\nTo enable real Google login...\n(You can test without login)');
    return;
  }
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then((result) => {
      console.log('‚úÖ Login successful!', result.user);
      const authModal = document.getElementById('authModal');
      if (authModal) authModal.classList.add('hidden');
      alert('‚úÖ Login successful! Welcome ' + result.user.displayName);
    })
    .catch((error) => {
      console.error('‚ùå Login error:', error);
      alert('‚ùå Login failed: ' + error.message);
    });
};

window.handleMyButton = function() {
  if (currentUser) {
    const msg = `üë§ Your Profile\n\n` +
      `Name: ${userState.name}\n` +
      `Email: ${userState.email}\n` +
      `Level: ${userState.level} - ${getLevelName(userState.level)}\n` +
      `Total XP: ${userState.xp}\n` +
      `Total Days: ${userState.totalDays}\n` +
      `Current Streak: ${userState.streak} üî•`;
    alert(msg);
  } else {
    alert('‚ö†Ô∏è Please login first to view your profile!');
    const authModal = document.getElementById('authModal');
    if (authModal) authModal.classList.remove('hidden');
  }
};

if (auth) {
  auth.onAuthStateChanged(async (user) => {
    const authModal   = document.getElementById('authModal');
    const userSection = document.getElementById('userSection');
    const loginBtn    = document.getElementById('loginBtn');
    if (user) {
      currentUser = user;
      userState.uid = user.uid;
      userState.name = user.displayName;
      userState.email = user.email;
      userState.photoURL = user.photoURL;
      if (authModal)   authModal.classList.add('hidden');
      if (userSection) userSection.style.display = 'block';
      if (loginBtn)    loginBtn.style.display = 'none';
      await loadUserData();
      updateUserUI();
    } else {
      currentUser = null;
      if (userSection) userSection.style.display = 'none';
      if (loginBtn)    loginBtn.style.display = 'block';
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  console.log('‚úÖ DOM loaded successfully');
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn && auth) {
    logoutBtn.addEventListener('click', async () => {
      try { await auth.signOut(); console.log('‚úÖ Logged out successfully'); }
      catch (error) { console.error('‚ùå Logout error:', error); }
    });
  }
  console.log('‚úÖ All event listeners set up');
});

// ===================== Data =====================
const drama = [
  {t:'Goblin',c:'Kim Shin to Eun-tak',k:'ÎÑàÎäî, ÎÇ¥Í∞Ä ÏûÉÏùÄ Î™®Îì† ÎÇ†Îì§Ïù¥Îã§.',e:'You are all the days I lost',p:'neoneun, naega ireun modeun naldeulida',sub:'Goblin'},
  {t:'Goblin',c:'Eun-tak reflection',k:'ÌòºÏûêÏòÄÎçò ÏãúÍ∞ÑÎèÑ, ÎÇòÎ•º ÎßåÎì§ÏóàÏñ¥.',e:'Even my lonely days shaped me',p:'honjayotteon sigando, nareul mandeureosseo',sub:'Goblin'},
  {t:'Crash Landing on You',c:'Ri Jeong-hyeok',k:'ÎÑê Ï¢ãÏïÑÌïú Í≤å, ÏûòÎ™ªÏù¥ÏóàÏùÑÍπå?',e:'Was it wrong that I liked you?',p:'neol joahan ge, jalmosieosseulkka',sub:'Crash Landing'},
  {t:'Crash Landing on You',c:'Yoon Se-ri',k:'ÎÅùÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïú ÏàúÍ∞Ñ, Îã§Ïãú ÏãúÏûëÎêêÏñ¥.',e:'When I thought it was over it began again',p:'kkeutirago saenggakan sungan, dasi sijakdwaesseo',sub:'Crash Landing'},
  {t:'Itaewon Class',c:'Park Sae-ro-yi',k:'ÎÇòÎäî, ÎÇ¥ Î∞©ÏãùÎåÄÎ°ú Í∞ÑÎã§.',e:'I go my own way',p:'naneun, nae bangsikdaero ganda',sub:'Itaewon'},
  {t:'SKY Castle',c:'Kang Ye-seo',k:'Ïà® Ï¢Ä Ïâ¨Í≤å Ìï¥Ï§ò.',e:'Let me breathe, please',p:'sum jom swige haejwo',sub:'SKY Castle'},
  {t:'Descendants of the Sun',c:'Yoo Si-jin',k:'Î∂ÄÎ•¥Î©¥ Í∞ÄÍ≥†, Ïïà Î∂ÄÎ•¥Î©¥ Ïïà Í∞Ä.',e:'If you call I go if not I stay',p:'bureumyeon gago, an bureumyeon an ga',sub:'Descendants'},
  {t:'My Love from the Star',c:'Cheon Song-yi',k:'Ï≤´Îàà Ïò§Îäî ÎÇ†Ïóî, Ïö©Í∏∞Í∞Ä ÌïÑÏöîÌï¥.',e:'On the first snow you need courage',p:'cheotnun oneun naren, yonggiga piryohae',sub:'My Love'},
  {t:'Mr. Sunshine',c:'Go Ae-shin',k:'Ïä¨Ìîà ÎÇ†Ïóî, ÎÇ¥ Ïñ¥Íπ® ÎπåÎ†§Ï§ÑÍ≤åÏöî.',e:'On sad days you can lean on my shoulder',p:'seulpeun naren, nae eokkae billyeojulgeyo',sub:'Mr. Sunshine'},
  {t:'Reply 1988',c:'Deok-sun',k:'Ïò§ÎäòÎèÑ ÌååÏù¥ÌåÖ!',e:'Fighting for today',p:'oneuldo paiting',sub:'Reply 1988'},
  {t:'Hospital Playlist',c:'Ik-jun',k:'Î∞•ÏùÄ Íº≠ Ï±ôÍ≤® Î®πÏñ¥.',e:'Remember to eat your meals',p:'babeun kkok chaenggyeo meogeo',sub:'Hospital'},
  {t:'Extraordinary Attorney Woo',c:'Woo Young-woo',k:'Í∏∞Îü¨Í∏∞, ÌÜ†ÎßàÌÜ†, Ïä§ÏúÑÏä§, Ïù∏ÎèÑÏù∏.',e:'Palindrome wordplay',p:'girugi, tomato, seuwiseu, indoin',sub:'Attorney Woo'},
  {t:'Twenty Five Twenty One',c:'Na Hee-do',k:'ÏßÄÍ∏à Ïù¥ ÏàúÍ∞ÑÏù¥, Ï†ÑÎ∂ÄÏïº.',e:'This moment is everything',p:'jigeum i sungani, jeonbuya',sub:'Twenty Five'},
  {t:'D.P.',c:'Jun-ho',k:'Í¥úÏ∞ÆÏïÑ. Î≤ÑÌã∏ Ïàò ÏûàÏñ¥.',e:'It is okay we can endure',p:'gwaenchana. beotil su isseo',sub:'D.P.'},
  {t:'Signal',c:'Detective',k:'Ìè¨Í∏∞ÌïòÎ©¥, Í±∞Í∏∞ÏÑú ÎÅùÏù¥Ïïº.',e:'If you give up it ends there',p:'pogihamyeon, geogiseo kkeusiya',sub:'Signal'},
  {t:'Our Blues',c:'Mother',k:'Ï≤úÏ≤úÌûà Ìï¥ÎèÑ, Í¥úÏ∞ÆÏïÑ.',e:'It is okay to go slow',p:'cheoncheonhi haedo, gwaenchana',sub:'Our Blues'},
  {t:'Hometown Cha Cha Cha',c:'Hong Du-sik',k:'ÎãµÏùÄ Îäò, Í∞ÄÍπåÏù¥Ïóê ÏûàÏñ¥.',e:'The answer is always close by',p:'dabeun neul, gakkaie isseo',sub:'Hometown'},
  {t:'Misaeng',c:'Manager Oh',k:'ÏûëÏùÄ ÏÑ±Ïã§Ïù¥, ÌÅ∞ Î≥ÄÌôîÎ•º ÎßåÎì†Îã§.',e:'Small diligence makes big change',p:'jageun seongsiri, keun byeonhwareul mandeunda',sub:'Misaeng'}
];

const daily = [
  {t:'Greeting',c:'First meeting',k:'ÏïàÎÖïÌïòÏÑ∏Ïöî.',e:'Hello',p:'annyeonghaseyo',sub:'Greeting'},
  {t:'Greeting',c:'Casual hi',k:'ÏïàÎÖï!',e:'Hi',p:'annyeong',sub:'Greeting'},
  {t:'Greeting',c:'Long time',k:'Ïò§ÎûúÎßåÏù¥ÏóêÏöî!',e:'Long time no see!',p:'oraenmanieyo',sub:'Greeting'},
  {t:'Greeting',c:'How are you',k:'Ïûò ÏßÄÎÉàÏñ¥Ïöî?',e:'Have you been well?',p:'jal jinaesseoyo',sub:'Greeting'},
  {t:'Greeting',c:'Introduction',k:'Ï†ÄÎäî ÎØºÏö∞ÏòàÏöî.',e:'I am Minwoo',p:'jeoneun minuyeyo',sub:'Greeting'},
  {t:'Cafe',c:'Order',k:'ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ Ìïú Ïûî, Ï£ºÏÑ∏Ïöî.',e:'One americano, please',p:'amerikano han jan, juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Size',k:'ÎùºÏßÄÎ°ú Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.',e:'Large, please',p:'rajiro butakdeurimnida',sub:'Cafe'},
  {t:'Cafe',c:'To go',k:'Ìè¨Ïû•Ìï†Í≤åÏöî.',e:'To go, please',p:'pojanghalgeyo',sub:'Cafe'},
  {t:'Cafe',c:'No ice',k:'ÏñºÏùåÏùÄ Îπº Ï£ºÏÑ∏Ïöî.',e:'No ice, please',p:'eoreumeun ppae juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Compliment',k:'Ïª§ÌîºÍ∞Ä Ï†ïÎßê ÎßõÏûàÎÑ§Ïöî!',e:'The coffee is really good',p:'keopiga jeongmal masinneyo',sub:'Cafe'},
  {t:'Restaurant',c:'Table',k:'Îëê Î™ÖÏù¥ÏóêÏöî.',e:'Table for two',p:'du myeongieyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Recommendation',k:'Ï∂îÏ≤ú Î©îÎâ¥Í∞Ä ÏûàÎÇòÏöî?',e:'Do you have a recommendation?',p:'chucheon menyuga innayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Not spicy',k:'Ïïà Îß§Ïö¥ Í±∏Î°ú, Ï£ºÏÑ∏Ïöî.',e:'Not spicy, please',p:'an maeun geollo, juseyo',sub:'Restaurant'},
  {t:'Restaurant',c:'More water',k:'Î¨º Ï¢Ä Îçî Ï£ºÏãúÍ≤†Ïñ¥Ïöî?',e:'Could I get more water?',p:'mul jom deo jusigesseoyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Check',k:'Í≥ÑÏÇ∞ÏÑú Î∂ÄÌÉÅÎìúÎ†§Ïöî.',e:'Check, please',p:'gyesanseo butakdeuryeoyo',sub:'Restaurant'},
  {t:'Shopping',c:'Price',k:'ÏñºÎßàÏòàÏöî?',e:'How much is it?',p:'eolmayeyo',sub:'Shopping'},
  {t:'Shopping',c:'Try on',k:'ÏûÖÏñ¥Î¥êÎèÑ Îê†ÍπåÏöî?',e:'May I try this on?',p:'ibeobwado doelkkayo',sub:'Shopping'},
  {t:'Shopping',c:'Other color',k:'Îã§Î•∏ ÏÉâ, ÏûàÏñ¥Ïöî?',e:'Do you have another color?',p:'dareun saek, isseoyo',sub:'Shopping'},
  {t:'Shopping',c:'Discount',k:'Ìï†Ïù∏ Í∞ÄÎä•Ìï†ÍπåÏöî?',e:'Is a discount possible?',p:'halin ganeunhalkkayo',sub:'Shopping'},
  {t:'Shopping',c:'Card payment',k:'Ïπ¥ÎìúÎ°ú Í≤∞Ï†úÌï†Í≤åÏöî.',e:'I will pay by card',p:'kadeuro gyeoljehalgeyo',sub:'Shopping'},
  {t:'Health',c:'Headache',k:'Î®∏Î¶¨Í∞Ä ÏïÑÌååÏöî.',e:'I have a headache',p:'meoriga apayo',sub:'Health'},
  {t:'Health',c:'Cold medicine',k:'Í∞êÍ∏∞ÏïΩ, ÏûàÏñ¥Ïöî?',e:'Do you have cold medicine?',p:'gamgiyak, isseoyo',sub:'Health'},
  {t:'Health',c:'Allergy',k:'ÎïÖÏΩ© ÏïåÎ†àÎ•¥Í∏∞Í∞Ä ÏûàÏñ¥Ïöî.',e:'I have a peanut allergy',p:'ttangkong allerugiga isseoyo',sub:'Health'},
  {t:'Health',c:'Where hurts',k:'Ïñ¥ÎîîÍ∞Ä ÏïÑÌîÑÏÑ∏Ïöî?',e:'Where does it hurt?',p:'eodiga apeuseyo',sub:'Health'},
  {t:'Health',c:'After meals',k:'ÏãùÌõÑÏóê ÎìúÏÑ∏Ïöî.',e:'Take it after meals',p:'sikhue deuseyo',sub:'Health'},
  {t:'Social',c:'Compliment',k:'Ï†ïÎßê ÏûòÌïòÏãúÎÑ§Ïöî!',e:'You are really good!',p:'jeongmal jalhasineyo',sub:'Social'},
  {t:'Social',c:'Movie invite',k:'Í∞ôÏù¥ ÏòÅÌôî Î≥¥Îü¨ Í∞àÎûòÏöî?',e:'Do you want to see a movie?',p:'gachi yeonghwa boreo gallaeyo',sub:'Social'},
  {t:'Social',c:'Decline',k:'ÎØ∏ÏïàÌïòÏßÄÎßå, Ïò§ÎäòÏùÄ Ïñ¥Î†§ÏõåÏöî.',e:'Sorry, but today is difficult',p:'mianhajiman, oneureun eoryeowoyo',sub:'Social'},
  {t:'Social',c:'Tomorrow',k:'ÎÇ¥Ïùº ÏãúÍ∞Ñ, Í¥úÏ∞ÆÏúºÏÑ∏Ïöî?',e:'Are you free tomorrow?',p:'naeil sigan, gwaenchanseuseyo',sub:'Social'},
  {t:'Social',c:'Thank you',k:'ÎèÑÏôÄÏ£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§.',e:'Thank you for your help',p:'dowajusyeoseo gamsahamnida',sub:'Social'}
];

const travel = [
  {t:'Airport',c:'Tourism',k:'Í¥ÄÍ¥ëÌïòÎü¨ ÏôîÏäµÎãàÎã§.',e:'I am here for tourism',p:'gwangwanghareo wasseumnida',sub:'Airport'},
  {t:'Airport',c:'One week',k:'ÏùºÏ£ºÏùº Î®∏Î¨º ÏòàÏ†ïÏûÖÎãàÎã§.',e:'I will stay for one week',p:'iljuil meomul yejeongimnida',sub:'Airport'},
  {t:'Airport',c:'Lost baggage',k:'ÏàòÌïòÎ¨ºÏù¥ Ïïà ÎÇòÏôîÏñ¥Ïöî.',e:'My baggage did not come out',p:'suhamuri an nawasseoyo',sub:'Airport'},
  {t:'Airport',c:'Airport bus',k:'Í≥µÌï≠Î≤ÑÏä§Îäî Ïñ¥ÎîîÏóêÏÑú ÌÉÄÏöî?',e:'Where do I take the airport bus?',p:'gonghang beoseuneun eodieseo tayo',sub:'Airport'},
  {t:'Airport',c:'Exchange',k:'ÌôòÏ†ÑÏùÄ Ïñ¥ÎîîÏÑú Ìï¥Ïöî?',e:'Where can I exchange money?',p:'hwanjeoneun eodiseo haeyo',sub:'Airport'},
  {t:'Hotel',c:'Check in',k:'ÏòàÏïΩÌñàÏñ¥Ïöî. Ï≤¥ÌÅ¨Ïù∏ ÌïòÍ≥† Ïã∂Ïñ¥Ïöî.',e:'I have a reservation. I want to check in',p:'yeyakhaesseoyo. chekeuinhago sipeoyo',sub:'Hotel'},
  {t:'Hotel',c:'WiFi',k:'ÏôÄÏù¥ÌååÏù¥ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≠êÏòàÏöî?',e:'What is the WiFi password?',p:'waipai bimilbeonhoga mwoyeyo',sub:'Hotel'},
  {t:'Hotel',c:'Towels',k:'ÏàòÍ±¥ÏùÑ Îçî Í∞ÄÏ†∏Îã§ Ï£ºÏÑ∏Ïöî.',e:'Please bring more towels',p:'sugeoneul deo gajyeoda juseyo',sub:'Hotel'},
  {t:'Hotel',c:'No hot water',k:'Ïò®ÏàòÍ∞Ä ÎÇòÏò§ÏßÄ ÏïäÏïÑÏöî.',e:'There is no hot water',p:'onsuga naoji anayo',sub:'Hotel'},
  {t:'Hotel',c:'Check out',k:'Ï≤¥ÌÅ¨ÏïÑÏõÉÏùÄ Î™á ÏãúÏòàÏöî?',e:'What time is check out?',p:'chekeuauseun myeot siyeyo',sub:'Hotel'},
  {t:'Transport',c:'Subway',k:'ÏßÄÌïòÏ≤†Ïó≠Ïù¥ Ïñ¥ÎîîÏòàÏöî?',e:'Where is the subway station?',p:'jihacheol yeogi eodiyeyo',sub:'Transport'},
  {t:'Transport',c:'Direction',k:'Ïù¥Ï™ΩÏúºÎ°ú Ï≠â Í∞ÄÏÑ∏Ïöî.',e:'Go straight this way',p:'ijjogeuro jjuk gaseyo',sub:'Transport'},
  {t:'Transport',c:'Transfer',k:'Ïó¨Í∏∞ÏÑú Í∞àÏïÑÌÉÄÏïº Ìï¥Ïöî.',e:'I need to transfer here',p:'yeogiseo garataya haeyo',sub:'Transport'},
  {t:'Transport',c:'Last train',k:'ÎßâÏ∞®Í∞Ä Î™á ÏãúÏòàÏöî?',e:'What time is the last train?',p:'makchaga myeot siyeyo',sub:'Transport'},
  {t:'Transport',c:'Top up card',k:'ÍµêÌÜµÏπ¥Îìú Ï∂©Ï†ÑÌïòÍ≥† Ïã∂Ïñ¥Ïöî.',e:'I want to top up my transit card',p:'gyotong kadeu chungjeonhago sipeoyo',sub:'Transport'},
  {t:'Emergency',c:'Help',k:'ÎèÑÏôÄÏ£ºÏÑ∏Ïöî!',e:'Please help me!',p:'dowajuseyo',sub:'Emergency'},
  {t:'Emergency',c:'Police',k:'Í≤ΩÏ∞∞ÏùÑ Î∂àÎü¨ Ï£ºÏÑ∏Ïöî.',e:'Call the police, please',p:'gyeongchareul bulleo juseyo',sub:'Emergency'},
  {t:'Emergency',c:'Hospital',k:'Î≥ëÏõêÏóê Í∞ÄÏïº Ìï¥Ïöî.',e:'I need to go to a hospital',p:'byeongwone gaya haeyo',sub:'Emergency'},
  {t:'Emergency',c:'Lost wallet',k:'ÏßÄÍ∞ëÏùÑ ÏûÉÏñ¥Î≤ÑÎ†∏Ïñ¥Ïöî.',e:'I lost my wallet',p:'jigabeul ileobeoryeosseoyo',sub:'Emergency'},
  {t:'Emergency',c:'Lost',k:'Í∏∏ÏùÑ ÏûÉÏóàÏñ¥Ïöî.',e:'I am lost',p:'gireul ilheosseoyo',sub:'Emergency'}
];

// --- Plus data (extended) ---
const dramaPlus = [
  {t:'Romance',c:'Secret Garden',k:'ÎÑ§Í∞Ä ÎàÑÍµ∞ÏßÄ ÏïåÍ∏∞ÎèÑ Ï†ÑÏóê, Ï¢ãÏïÑÌñàÏñ¥.',e:'I liked you before knowing who you were',p:'nega nugunji algido jeone, joahaesseo',sub:'Romance'},
  {t:'Romance',c:'Hotel Del Luna',k:'Ï≤ú ÎÖÑÏùÑ Í∏∞Îã§Î†∏Ïñ¥, ÎÑàÎ•º.',e:'I waited a thousand years for you',p:'cheon nyeoneul gidaryeosseo, neoreul',sub:'Romance'},
  {t:'Romance',c:'What is Love',k:'ÏÇ¨ÎûëÏù¥ Î≠îÎç∞? Î®πÎäî Í±∞Ïïº?',e:'What is love? Can you eat it?',p:'sarangi mwonde? meongneun geoya',sub:'Romance'},
  {t:'Romance',c:'Vincenzo',k:'ÏïÖÎãπÎèÑ ÏÇ¨ÎûëÌï† Ïàò ÏûàÎÇòÏöî?',e:'Can villains love too?',p:'akdangdo saranghal su innayo',sub:'Romance'},
  {t:'Romance',c:'Business Proposal',k:'Í∞ÄÏßú Ïó∞Ïï†Í∞Ä ÏßÑÏßúÍ∞Ä ÎêêÏñ¥.',e:'Fake dating became real',p:'gajja yeonaega jinjjaga dwaesseo',sub:'Romance'},
  {t:'Life',c:'Life wisdom',k:'Ïù∏ÏÉùÏùÄ ÏÜçÎèÑÍ∞Ä ÏïÑÎãàÎùº Î∞©Ìñ•Ïù¥Ïïº.',e:'Life is about direction not speed',p:'insaengeun sokdoga anira banghyangiya',sub:'Life'},
  {t:'Life',c:'Decision',k:'ÏÑ†ÌÉùÏùÄ ÎÇ¥Í∞Ä ÌïòÎäî Í±∞Ïïº.',e:'The choice is mine to make',p:'seontaegeun naega haneun geoya',sub:'Life'},
  {t:'Life',c:'Growth',k:'Ïñ¥Ï†úÏùò ÎÇòÎ≥¥Îã§ ÎÇòÏïÑÏßÄÎ©¥ Îèº.',e:'Just be better than yesterday',p:'eojeui naboda naajimyeon dwae',sub:'Life'},
  {t:'Life',c:'Present',k:'Ïò§ÎäòÏù¥ ÏÑ†Î¨ºÏù¥Ïïº.',e:'Today is a gift',p:'oneuri seonmuriya',sub:'Life'},
  {t:'Life',c:'Journey',k:'Í∞ÄÎäî Í∏∏Ïù¥ ÍΩÉÍ∏∏Ïù¥Î©¥ Ï¢ãÍ≤†Ïñ¥.',e:'Hope your path is filled with flowers',p:'ganeun giri kkotgirimyeon jokesseo',sub:'Life'},
  {t:'Support',c:'Cheer up',k:'ÎÑå Ï∂©Î∂ÑÌûà ÏûòÌïòÍ≥† ÏûàÏñ¥.',e:'You are doing well enough',p:'neon chungbunhi jalhago isseo',sub:'Support'},
  {t:'Support',c:'Comfort',k:'Ïö∏Ïñ¥ÎèÑ Í¥úÏ∞ÆÏïÑ.',e:'It is okay to cry',p:'ureodo gwaenchana',sub:'Support'},
  {t:'Support',c:'Belief',k:'ÎÇú ÎÑ§Í∞Ä Ìï† Ïàò ÏûàÎã§Í≥† ÎØøÏñ¥.',e:'I believe you can do it',p:'nan nega hal su itdago mideo',sub:'Support'},
  {t:'Support',c:'Together',k:'ÌòºÏûêÍ∞Ä ÏïÑÎãàÏïº.',e:'You are not alone',p:'honjaga aniya',sub:'Support'},
  {t:'Support',c:'Rest',k:'Ïâ¨Ïñ¥ÎèÑ Í¥úÏ∞ÆÏïÑ.',e:'It is okay to rest',p:'swieodo gwaenchana',sub:'Support'}
];

const dailyPlus = [
  {t:'Work',c:'Meeting',k:'ÌöåÏùòÎäî Î™á ÏãúÏóê ÏãúÏûëÌï¥Ïöî?',e:'What time does the meeting start?',p:'hoeuineun myeot sie sijakaeyo',sub:'Work'},
  {t:'Work',c:'Deadline',k:'ÎßàÍ∞êÏùºÏù¥ Ïñ∏Ï†úÏòàÏöî?',e:'When is the deadline?',p:'magamiri eonjeyeyo',sub:'Work'},
  {t:'Work',c:'Break',k:'Ïû†Ïãú Ïâ¨ÏóàÎã§ Ìï†Í≤åÏöî.',e:'I will take a short break',p:'jamsi swieotda halgeyo',sub:'Work'},
  {t:'Work',c:'Overtime',k:'Ïò§Îäò ÏïºÍ∑ºÌï¥Ïïº Ìï¥Ïöî.',e:'I have to work overtime today',p:'oneul yageunhaeya haeyo',sub:'Work'},
  {t:'Work',c:'Weekend',k:'Ï£ºÎßêÏóêÎèÑ ÏùºÌï¥Ïïº Ìï¥Ïöî?',e:'Do we have to work on weekends?',p:'jumaredo ilhaeya haeyo',sub:'Work'},
  {t:'Tech',c:'WiFi issue',k:'ÏôÄÏù¥ÌååÏù¥Í∞Ä Ïïà ÎèºÏöî.',e:'WiFi is not working',p:'waipaiga an dwaeyo',sub:'Tech'},
  {t:'Tech',c:'Charging',k:'Ï∂©Ï†ÑÍ∏∞ Ï¢Ä ÎπåÎ¶¥ Ïàò ÏûàÏùÑÍπåÏöî?',e:'May I borrow a charger?',p:'chungjeongi jom billil su isseulkkayo',sub:'Tech'},
  {t:'Tech',c:'Password',k:'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûäÏñ¥Î≤ÑÎ†∏Ïñ¥Ïöî.',e:'I forgot the password',p:'bimilbeonhoreul ijeobeoryeosseoyo',sub:'Tech'},
  {t:'Tech',c:'App',k:'Ïñ¥ÌîåÏùÑ Îã§Ïö¥Î∞õÏïÑÏïº Ìï¥Ïöî.',e:'I need to download the app',p:'eopeureul daunbadaya haeyo',sub:'Tech'},
  {t:'Tech',c:'Update',k:'ÏóÖÎç∞Ïù¥Ìä∏Í∞Ä ÌïÑÏöîÌï¥Ïöî.',e:'It needs an update',p:'eopdeiteuga piryohaeyo',sub:'Tech'},
  {t:'Exercise',c:'Gym',k:'Ìó¨Ïä§Ïû•ÏùÄ Î™á ÏãúÍπåÏßÄ Ìï¥Ïöî?',e:'Until what time is the gym open?',p:'helseujang-eun myeot sikkaji haeyo',sub:'Exercise'},
  {t:'Exercise',c:'Running',k:'Í∞ôÏù¥ Îã¨Î¶¨Í∏∞ Ìï†ÎûòÏöî?',e:'Want to go running together?',p:'gachi dalligi hallaeyo',sub:'Exercise'},
  {t:'Exercise',c:'Yoga',k:'ÏöîÍ∞Ä ÏàòÏóÖ Ïã†Ï≤≠ÌñàÏñ¥Ïöî.',e:'I signed up for yoga class',p:'yoga sueop sincheonghaesseoyo',sub:'Exercise'},
  {t:'Exercise',c:'Diet',k:'Îã§Ïù¥Ïñ¥Ìä∏ Ï§ëÏù¥ÏóêÏöî.',e:'I am on a diet',p:'daieoteu jung-ieyo',sub:'Exercise'},
  {t:'Exercise',c:'Healthy',k:'Í±¥Í∞ïÏù¥ ÏµúÍ≥†ÏòàÏöî.',e:'Health is the best',p:'geongangi choegoyeyo',sub:'Exercise'}
];

const travelPlus = [
  {t:'Convenience',c:'Buy water',k:'ÏÉùÏàò Ìïú Î≥ë Ï£ºÏÑ∏Ïöî.',e:'One bottle of water please',p:'saengsu han byeong juseyo',sub:'Convenience'},
  {t:'Convenience',c:'Microwave',k:'Ïù¥Í±∞ Îç∞Ïõå Ï£ºÏã§ Ïàò ÏûàÏñ¥Ïöî?',e:'Can you heat this up?',p:'igeo dewo jusil su isseoyo',sub:'Convenience'},
  {t:'Convenience',c:'T-money',k:'Ìã∞Î®∏Îãà Ïπ¥Îìú Ïó¨Í∏∞ÏÑú ÏÇ¥ Ïàò ÏûàÏñ¥Ïöî?',e:'Can I buy a T-money card here?',p:'timoni kadeu yeogiseo sal su isseoyo',sub:'Convenience'},
  {t:'Convenience',c:'Top up',k:'Ï∂©Ï†ÑÎèÑ Í∞ÄÎä•Ìï¥Ïöî?',e:'Can I top it up here?',p:'chungjeondo ganeunghaeyo',sub:'Convenience'},
  {t:'Convenience',c:'Utensils',k:'ÏùºÌöåÏö© ÏàòÏ†Ä Ï¢Ä Ï£ºÏÑ∏Ïöî.',e:'Disposable spoon and chopsticks please',p:'ilhoyeong sujeo jom juseyo',sub:'Convenience'},
  {t:'Street Food',c:'Order skewers',k:'Ïñ¥Î¨µ Îëê Íº¨Ïπò Ï£ºÏÑ∏Ïöî.',e:'Two fish cake skewers please',p:'eomuk du kkochi juseyo',sub:'Street Food'},
  {t:'Street Food',c:'Sugar level',k:'ÏÑ§ÌÉïÏùÄ Ï†ÅÍ≤å ÎÑ£Ïñ¥ Ï£ºÏÑ∏Ïöî.',e:'Please add less sugar',p:'seoltangeun jeokge neo-eo juseyo',sub:'Street Food'},
  {t:'Street Food',c:'Spicy tteokbokki',k:'Îçú Îß§Ïö¥ Îñ°Î≥∂Ïù¥ ÏûàÏñ¥Ïöî?',e:'Do you have less spicy tteokbokki?',p:'deol maeun tteokbokki isseoyo',sub:'Street Food'},
  {t:'Street Food',c:'To go pack',k:'Ìè¨Ïû• Ïö©Í∏∞Î°ú Î∂ÄÌÉÅÌï¥Ïöî.',e:'Please pack it to go',p:'pojang yonggiro butakaeyo',sub:'Street Food'},
  {t:'Street Food',c:'Pay now',k:'ÏßÄÍ∏à Í≥ÑÏÇ∞Ìï†Í≤åÏöî.',e:'I will pay now',p:'jigeum gyesanhalgeyo',sub:'Street Food'},
  {t:'Market',c:'Sample',k:'Îßõ Ï¢Ä Î¥êÎèÑ ÎèºÏöî?',e:'May I taste a sample?',p:'mat jom bwado dwaeyo',sub:'Market'},
  {t:'Market',c:'Half kilo',k:'Î∞ò Í∑ºÎßå Ï£ºÏÑ∏Ïöî.',e:'Half a geun please',p:'ban geunman juseyo',sub:'Market'},
  {t:'Market',c:'Fresh today',k:'Ïò§Îäò Îì§Ïñ¥Ïò® Í±¥Í∞ÄÏöî?',e:'Is this fresh today?',p:'oneul deureoon geongayo',sub:'Market'},
  {t:'Market',c:'Bargain',k:'Ï°∞Í∏àÎßå ÍπéÏïÑ Ï£ºÏã§ Ïàò ÏûàÎÇòÏöî?',e:'Could you lower the price a little?',p:'jogeumman kkakka jusil su innayo',sub:'Market'},
  {t:'Market',c:'Bag',k:'Î¥âÌà¨ ÌïÑÏöîÌï¥Ïöî.',e:'I need a bag',p:'bongtu piryohaeyo',sub:'Market'},
  {t:'Duty Free',c:'Passport check',k:'Ïó¨Í∂å Î≥¥Ïó¨ÎìúÎ¶¥Í≤åÏöî.',e:'I will show my passport',p:'yeogwon boyeodeurilgeyo',sub:'Duty Free'},
  {t:'Duty Free',c:'Tax refund desk',k:'ÌÉùÏä§ Î¶¨ÌéÄÎìúÎäî Ïñ¥ÎîîÏóêÏÑú Ìï¥Ïöî?',e:'Where is the tax refund desk?',p:'taekseu ripeondeuneun eodieseo haeyo',sub:'Duty Free'},
  {t:'Department',c:'Cosmetics tester',k:'ÌÖåÏä§ÌÑ∞ ÏÇ¨Ïö©Ìï¥ Î¥êÎèÑ Îê†ÍπåÏöî?',e:'May I try the tester?',p:'teseuteo sayonghae bwado doelkkayo',sub:'Department'},
  {t:'Department',c:'Exchange size',k:'ÏÇ¨Ïù¥Ï¶à ÍµêÌôò Í∞ÄÎä•Ìï¥Ïöî?',e:'Can I exchange for a different size?',p:'saijeu gyohwan ganeunghaeyo',sub:'Department'},
  {t:'Department',c:'Gift wrap',k:'ÏÑ†Î¨º Ìè¨Ïû• Í∞ÄÎä•Ìï†ÍπåÏöî?',e:'Can you gift wrap it?',p:'seonmul pojang ganeunhalkkayo',sub:'Department'},
  {t:'Food Court',c:'Find seat',k:'ÏûêÎ¶¨ Î®ºÏ†Ä Ïû°Í≥† Ï£ºÎ¨∏ÌïòÎÇòÏöî?',e:'Do we get seats first then order?',p:'jari meonjeo japgo jumunhanayo',sub:'Food Court'},
  {t:'Food Court',c:'Buzzer',k:'ÏßÑÎèôÎ≤® Î∞õÏïòÏñ¥Ïöî.',e:'I received the buzzer',p:'jindongbel badasseoyo',sub:'Food Court'},
  {t:'Food Court',c:'Pick up',k:'Ïñ¥ÎîîÏÑú Î∞õÏïÑÍ∞ÄÏöî?',e:'Where do I pick it up?',p:'eodiseo badagayo',sub:'Food Court'},
  {t:'Restaurant',c:'Wait list',k:'Ïõ®Ïù¥ÌåÖ Î™ÖÎã®Ïóê Ïò¨Î†§ Ï£ºÏÑ∏Ïöî.',e:'Please put me on the waiting list',p:'weiting myeongdane ollyeo juseyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Share dish',k:'Ïù¥Í±∞ Í∞ôÏù¥ ÎÇòÎà† Î®πÏñ¥ÎèÑ ÎèºÏöî?',e:'Can we share this dish?',p:'igeo gachi nanwo meogeodo dwaeyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Refill water',k:'Î¨ºÏùÄ ÏÖÄÌîÑÏù∏Í∞ÄÏöî?',e:'Is water self serve?',p:'mureun selpeu ingayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Extra side',k:'ÍπÄÏπò Ï°∞Í∏à Îçî Ï£ºÏã§ Ïàò ÏûàÎÇòÏöî?',e:'May I have a bit more kimchi?',p:'gimchi jogeum deo jusil su innayo',sub:'Restaurant'},
  {t:'Restaurant',c:'No pork',k:'ÎèºÏßÄÍ≥†Í∏∞ Îπº Ï£ºÏÑ∏Ïöî.',e:'Please remove pork',p:'dwaejigogi ppae juseyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Halal',k:'Ìï†ÎûÑ Î©îÎâ¥ ÏûàÎÇòÏöî?',e:'Do you have halal menu?',p:'hallal menyu innayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Vegan',k:'ÎπÑÍ±¥ Î©îÎâ¥ÎèÑ ÏûàÎÇòÏöî?',e:'Do you have vegan menu?',p:'bigeon menyudo innayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Allergy check',k:'Ïù¥ ÏùåÏãùÏóê ÎïÖÏΩ© Îì§Ïñ¥Í∞ÄÏöî?',e:'Does this dish contain peanuts?',p:'i eumsige ttangkong deureogayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Less salt',k:'ÏßúÏßÄ ÏïäÍ≤å Î∂ÄÌÉÅÌï¥Ïöî.',e:'Please make it less salty',p:'jjaji anke butakaeyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Separate bill',k:'Í∞ÅÏûê Í≥ÑÏÇ∞Ìï†Í≤åÏöî.',e:'We will pay separately',p:'gakja gyesanhalgeyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Take leftovers',k:'ÎÇ®ÏùÄ ÏùåÏãù Ìè¨Ïû•Ìï¥ Ï£ºÏÑ∏Ïöî.',e:'Please pack the leftovers',p:'nameun eumsik pojanghae juseyo',sub:'Restaurant'},
  {t:'Cafe',c:'Less ice',k:'ÏñºÏùåÏùÄ Ï°∞Í∏àÎßå ÎÑ£Ïñ¥ Ï£ºÏÑ∏Ïöî.',e:'Less ice please',p:'eoreumeun jogeumman neo-eo juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Syrup',k:'ÏãúÎüΩÏùÄ Îπº Ï£ºÏÑ∏Ïöî.',e:'Please hold the syrup',p:'sireobeun ppae juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Milk choice',k:'ÎëêÏú†Î°ú Î∞îÍøî Ï£ºÏÑ∏Ïöî.',e:'Please switch to soy milk',p:'duyuro bakkwo juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Name',k:'Ïù¥Î¶ÑÏùÄ LuciaÎ°ú Ï†ÅÏñ¥ Ï£ºÏÑ∏Ïöî.',e:'Please write the name Lucia',p:'ireumeun Lucia-ro jeogeo juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Receipt need',k:'ÏòÅÏàòÏ¶ù ÌïÑÏöîÌï¥Ïöî.',e:'I need the receipt',p:'yeongsujeung piryohaeyo',sub:'Cafe'},
  {t:'Payment',c:'No tip',k:'ÌåÅ Î¨∏ÌôîÍ∞Ä ÏóÜÏ£†?',e:'There is no tipping culture, right?',p:'tib munhwaga eopjyo',sub:'Payment'},
  {t:'Payment',c:'Mobile pay',k:'Í∞ÑÌé∏Í≤∞Ï†ú Í∞ÄÎä•Ìï¥Ïöî?',e:'Do you take mobile pay?',p:'ganpyeon gyeolje ganeunghaeyo',sub:'Payment'},
  {t:'Payment',c:'Split evenly',k:'NÎ∂ÑÏùò 1Î°ú Í≥ÑÏÇ∞Ìï¥ Ï£ºÏÑ∏Ïöî.',e:'Please split evenly',p:'en bune il-lo gyesanhae juseyo',sub:'Payment'},
  {t:'Payment',c:'Prepay',k:'ÏÑ†Í≤∞Ï†úÌï¥Ïïº ÌïòÎÇòÏöî?',e:'Do we pay first?',p:'seongyeolje haeya hanayo',sub:'Payment'},
  {t:'Delivery',c:'App help',k:'Î∞∞Îã¨ Ïï± Ï£ºÎ¨∏ ÎèÑÏôÄÏ£ºÏã§ÎûòÏöî?',e:'Could you help me order on the delivery app?',p:'baedal aep jumun dowajusillaeyo',sub:'Delivery'},
  {t:'Sightseeing',c:'Food alley',k:'ÎßõÏßë Í≥®Î™©Ïù¥ Ïñ¥ÎîîÏòàÏöî?',e:'Where is the food alley?',p:'matjib golmogi eodiyeyo',sub:'Sightseeing'},
  {t:'Sightseeing',c:'Opening day',k:'Ïò§Îäò ÏòÅÏóÖÌïòÎÇòÏöî?',e:'Are you open today?',p:'oneul yeongeop hanayo',sub:'Sightseeing'},
  {t:'Sightseeing',c:'Queue time',k:'ÎåÄÍ∏∞ ÏãúÍ∞ÑÏù¥ ÏñºÎßàÎÇò Í±∏Î†§Ïöî?',e:'How long is the wait?',p:'daegi sigani eolmana geollyeoyo',sub:'Sightseeing'}
];

// --- Merged arrays for app ---
const dramaAll  = [...drama, ...dramaPlus];
const dailyAll  = [...daily, ...dailyPlus];
const travelAll = [...travel, ...travelPlus];

// Subcategory & Icons (extended)
const subCategories = {
  daily: ['Greeting','Cafe','Restaurant','Shopping','Health','Social','Work','Tech','Exercise'],
  travel: ['Airport','Hotel','Transport','Emergency','Convenience','Street Food','Market','Duty Free','Department','Food Court','Payment','Delivery','Sightseeing']
  // dramaÎäî ÌòÑÏû¨ UIÏóêÏÑú ÏÑúÎ∏åÌïÑÌÑ∞ ÎπÑÎÖ∏Ï∂ú (ÏõêÌïòÎ©¥ 'Romance','Life','Support' Ï∂îÍ∞Ä ÌõÑ ÏïÑÎûò Ïà®ÍπÄ Ìï¥Ï†ú)
};

const subIcons = {
  'Greeting':'üëã','Cafe':'‚òï','Restaurant':'üçΩÔ∏è','Shopping':'üõçÔ∏è','Health':'üíä','Social':'üë•',
  'Work':'üíº','Tech':'üñ•Ô∏è','Exercise':'üèÉ',
  'Airport':'‚úàÔ∏è','Hotel':'üè®','Transport':'üöá','Emergency':'üÜò',
  'Convenience':'üè™','Street Food':'üå≠','Market':'üß∫','Duty Free':'üõÇ','Department':'üè¨',
  'Food Court':'ü•¢','Payment':'üí≥','Delivery':'üì¶','Sightseeing':'üìç'
};

// ===================== App State & Logic =====================
let st = { cat:'daily', sub:null, i:0, spd:0.75, filteredLines:[] };

function getLines() {
  const base = st.cat === 'drama' ? dramaAll : st.cat === 'daily' ? dailyAll : travelAll;
  return st.sub ? base.filter(item => item.sub === st.sub) : base;
}

function updateSubFilters() {
  const container = document.getElementById('subFilters');
  if (!container) return;

  // dramaÎäî Ïà®ÍπÄ (ÏõêÌïòÎ©¥ Ïù¥ Î∏îÎ°ù Ï†úÍ±∞ÌïòÍ≥† subCategories.drama Ï∂îÍ∞Ä)
  if (st.cat === 'drama') {
    container.style.display = 'none';
    return;
  }

  container.style.display = 'block';
  const cats = subCategories[st.cat] || [];

  container.innerHTML =
    '<div class="sub-filters">' +
    '<div class="filter-chip ' + (!st.sub ? 'active' : '') + '" onclick="filterSub(null)">All</div>' +
    cats.map(cat =>
      '<div class="filter-chip ' + (st.sub === cat ? 'active' : '') + '" onclick="filterSub(\'' + cat + '\')">' +
      (subIcons[cat] ? subIcons[cat] + ' ' : 'üè∑Ô∏è ') + cat +
      '</div>'
    ).join('') +
    '</div>';
}

function filterSub(sub) {
  st.sub = sub;
  st.i = 0;
  st.filteredLines = getLines();
  updateSubFilters();
  show();
}

function updateRepetitionDisplay() {
  const repCountEl = document.getElementById('repCount');
  if (repCountEl) repCountEl.textContent = st.repCount || 0;

  for (let i = 1; i <= 5; i++) {
    const dot = document.getElementById('dot' + i);
    if (!dot) continue;
    if (i <= (st.repCount || 0)) {
      dot.classList.add('completed');
      dot.textContent = '‚úì';
    } else {
      dot.classList.remove('completed');
      dot.textContent = '';
    }
  }

  const congrats = document.getElementById('congrats');
  if (congrats) {
    if ((st.repCount || 0) >= 5) congrats.classList.add('show');
    else congrats.classList.remove('show');
  }
}

function show() {
  st.filteredLines = getLines();

  if (st.filteredLines.length === 0) {
    st.filteredLines = st.cat === 'drama' ? dramaAll : st.cat === 'daily' ? dailyAll : travelAll;
    st.i = 0;
  }
  if (st.i >= st.filteredLines.length) st.i = 0;
  if (st.i < 0) st.i = 0;

  st.repCount = 0;

  const d = st.filteredLines[st.i];
  const badgeEl = document.getElementById('badge');
  const contextEl = document.getElementById('context');
  const koreanEl = document.getElementById('korean');
  const pronEl = document.getElementById('pronunciation');
  const engEl = document.getElementById('english');
  const progEl = document.getElementById('prog');

  if (badgeEl)   badgeEl.textContent = d.t;
  if (contextEl) contextEl.textContent = 'Conversation: ' + d.c;
  if (koreanEl)  koreanEl.textContent = d.k;
  if (pronEl)    pronEl.textContent = d.p;
  if (engEl)     engEl.textContent = '"' + d.e + '"';
  if (progEl)    progEl.textContent = (st.i + 1) + ' / ' + st.filteredLines.length;

  updateRepetitionDisplay();
}

function showError(msg) {
  const err = document.getElementById('errorMsg');
  if (!err) return;
  err.textContent = msg;
  err.style.display = 'block';
  setTimeout(() => { err.style.display = 'none'; }, 5000);
}

function speakText(txt, voices) {
  const synth = window.speechSynthesis;
  setTimeout(() => {
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = 'ko-KR';
    u.rate = st.spd;
    u.pitch = 1.0;
    u.volume = 1.0;
    const koVoice = voices.find(v =>
      v.lang && (v.lang === 'ko-KR' || v.lang === 'ko_KR' || v.lang.startsWith('ko-') || v.name.includes('Korean') || v.name.includes('ÌïúÍµ≠'))
    );
    if (koVoice) u.voice = koVoice;
    u.onerror = (e) => { console.error('Speech error:', e); showError('‚ö†Ô∏è Speech failed. Please try again.'); };
    u.onend = () => { /* noop */ };
    synth.speak(u);
  }, 200);
}

function play() {
  const current = st.filteredLines[st.i];
  const txt = current.k;

  if (!('speechSynthesis' in window)) {
    showError('‚ö†Ô∏è Your browser does not support text-to-speech. Try Chrome, Safari, or Edge.');
    return;
  }

  const synth = window.speechSynthesis;
  synth.cancel();

  let voices = synth.getVoices();
  if (voices.length === 0) {
    synth.onvoiceschanged = () => {
      voices = synth.getVoices();
      speakText(txt, voices);
    };
  } else {
    speakText(txt, voices);
  }

  // repetition
  if ((st.repCount || 0) < 5) {
    st.repCount = (st.repCount || 0) + 1;
    updateRepetitionDisplay();
    if (st.repCount >= 5) autoNext();
  }
}

function prev() {
  if (st.i > 0) {
    st.i--;
    st.repCount = 0;
    show();
  }
}

function next() {
  if (st.i < st.filteredLines.length - 1) {
    st.i++;
    st.repCount = 0;
    show();
  }
}

async function updatePracticeStats() {
  if (!currentUser || !db) return;
  const phraseId = st.filteredLines[st.i].k;
  userState.practiceCount[phraseId] = (userState.practiceCount[phraseId] || 0) + 5;
  userState.xp += 5;
  const newLevel = calculateLevel(userState.xp);
  if (newLevel > userState.level) {
    userState.level = newLevel;
    showError(`üéä Level Up! You are now Level ${newLevel} - ${getLevelName(newLevel)}!`);
  }
  await db.collection('users').doc(currentUser.uid).update({
    xp: userState.xp, level: userState.level, practiceCount: userState.practiceCount,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  updateUserUI();
}

function autoNext() {
  if (st.repCount >= 5) {
    if (currentUser && db) { updatePracticeStats(); }
    setTimeout(() => {
      if (st.i < st.filteredLines.length - 1) next();
      else showError('üéâ You completed all phrases! Great work!');
    }, 2000);
  }
}

function switchCategory(cat) {
  st.cat = cat;
  st.sub = null;
  st.i = 0;
  st.repCount = 0;

  document.getElementById('dramaBtn')?.classList.remove('active');
  document.getElementById('dailyBtn')?.classList.remove('active');
  document.getElementById('travelBtn')?.classList.remove('active');

  if (cat === 'drama') document.getElementById('dramaBtn')?.classList.add('active');
  else if (cat === 'daily') document.getElementById('dailyBtn')?.classList.add('active');
  else if (cat === 'travel') document.getElementById('travelBtn')?.classList.add('active');

  updateSubFilters();
  show();
}

// ===================== Events =====================
document.getElementById('dramaBtn').addEventListener('click', () => switchCategory('drama'));
document.getElementById('dailyBtn').addEventListener('click', () => switchCategory('daily'));
document.getElementById('travelBtn').addEventListener('click', () => switchCategory('travel'));
document.getElementById('playBtn').addEventListener('click', play);
document.getElementById('prevBtn').addEventListener('click', prev);
document.getElementById('nextBtn').addEventListener('click', next);

document.getElementById('speed').addEventListener('input', (e) => {
  st.spd = parseFloat(e.target.value);
  const speedTxt = document.getElementById('speedTxt');
  if (speedTxt) speedTxt.textContent = st.spd + 'x';
});

// Init
st.filteredLines = getLines(); // initial compute
document.getElementById('dailyBtn').classList.add('active');
updateSubFilters();
show();
</script>
</body>
</html>
