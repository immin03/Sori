<!doctype html>
<html lang="en">
<head>
  <!-- Google tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X1909BBKR5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-X1909BBKR5');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sori - Learn Korean</title>

  <!-- Firebase -->
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 680px; margin: 0 auto; padding: 12px;
      background: #faf8ff; min-height: 100vh;
    }
    h1 { font-size: 24px; margin: 0 0 4px 0; color: #7c3aed; font-weight: 800; }
    .intro { color: #9ca3af; font-size: 12px; margin-bottom: 10px; line-height: 1.3; font-weight: 500; }

    .header-container { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .top-btn{ padding:6px 12px; border-radius:10px; font-size:12px; font-weight:700; cursor:pointer; border:0; }
    .top-btn.primary{ background:#7c3aed; color:#fff; }

    .card { border-radius: 16px; padding: 16px; margin: 8px 0;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04); background: white; }

    .category-tabs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px; margin-bottom: 8px;
    }
    .tab-button {
      padding: 10px 14px; border: 2px solid #f3f4f6;
      border-radius: 14px; background: #f9fafb; color: #9ca3af;
      cursor: pointer; font-size: 13px; font-weight: 700; transition: all 0.2s;
    }
    .tab-button:hover { background: #f3f4f6; }
    .tab-button.active {
      background: #7c3aed; color: white; border-color: #7c3aed;
      box-shadow: 0 2px 8px rgba(124,58,237,0.2);
    }

    .badge { display: inline-block; background: #7c3aed; color: white;
      padding: 5px 10px; border-radius: 10px; font-size: 11px; font-weight: 800; }

    .icon-btn {
      border:none; background:transparent; width:28px; height:28px;
      display:inline-flex; align-items:center; justify-content:center;
      font-size:18px; line-height:1; padding:0; color:#9ca3af; cursor:pointer;
    }
    .icon-btn.active{ color:#d97706; }

    .context-box { background:#f9fafb; border-radius:8px; padding:6px 10px;
      margin-bottom:10px; font-size:12px; color:#6b7280; font-weight:600; }

    .korean-section { background:#f9fafb; border-radius:14px; padding:16px 12px; margin:8px 0; }
    .target-display { font-size:28px; font-weight:900; text-align:center; margin-bottom:6px; }
    .english-translation { color:#6b7280; font-size:16px; text-align:center; font-weight:600; }
    .pronunciation-hint { color:#9ca3af; font-size:13px; font-weight:600; text-align:center; font-style:italic; }

    button { padding: 12px 18px; border: 0; border-radius: 14px;
      background: #7c3aed; color: white; cursor: pointer; font-size: 15px; font-weight: 800;
      width: 100%; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2); transition: all 0.2s;
    }
    button:hover { background: #6d28d9; box-shadow: 0 4px 12px rgba(124,58,237,0.25); }

    .secondary { background: #f9fafb; color:#6b7280; }
    .secondary:hover { background:#f3f4f6; }

    .repetition-dots { display:flex; gap:5px; justify-content:center; margin-bottom:8px; }
    .rep-dot { width:32px; height:32px; border-radius:50%; border:2px solid #e5e7eb;
      display:flex; align-items:center; justify-content:center; font-size:14px; transition:all .3s; }
    .rep-dot.completed { background:#7c3aed; border-color:#7c3aed; transform:scale(1.1); }

    .progress { text-align:center; color:#7c3aed; font-size:13px; font-weight:700; margin-top:8px; }

    /* 로그인 모달 */
    .auth-section {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45);
      align-items:center; justify-content:center; z-index:9999; padding:16px;
    }
    .auth-section:not(.hidden){ display:flex; }
    .auth-card{
      max-width:360px; width:100%; padding:24px; border-radius:18px;
      background:white; box-shadow:0 18px 50px rgba(0,0,0,0.35);
      text-align:center; position:relative;
    }
    .auth-close {
      position:absolute; top:10px; right:10px;
      background:none; border:none; font-size:22px; color:#9ca3af; cursor:pointer;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header-container">
    <div class="header-left">
      <h1>Sori <span style="font-size: 14px; color:#9ca3af;">(beta)</span></h1>
      <div class="intro">Master Korean with K-Drama lines and daily conversations</div>
    </div>
    <div class="header-right">
      <button id="loginBtn" class="top-btn primary">Login</button>
    </div>
  </div>

  <div class="card">
    <div class="category-tabs">
      <button class="tab-button active" id="dailyBtn">Daily</button>
      <button class="tab-button" id="travelBtn">Travel</button>
      <button class="tab-button" id="dramaBtn">K-Drama</button>
      <button class="tab-button" id="savedBtn">★ Saved</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div class="badge" id="badge">Greeting</div>
      <button id="scrapBtn" class="icon-btn" title="Save this phrase">☆</button>
    </div>
    <div class="context-box" id="context">Conversation: First meeting</div>

    <div class="korean-section">
      <div class="target-display" id="korean">안녕하세요.</div>
      <div class="english-translation" id="english">"Hello"</div>
      <div class="pronunciation-hint" id="pronunciation">annyeonghaseyo</div>
    </div>

    <div class="repetition-dots">
      <div class="rep-dot" id="dot1"></div>
      <div class="rep-dot" id="dot2"></div>
      <div class="rep-dot" id="dot3"></div>
      <div class="rep-dot" id="dot4"></div>
      <div class="rep-dot" id="dot5"></div>
    </div>

    <button id="playBtn">Listen & Repeat</button>
    <div class="progress" id="prog">1 / 30</div>
  </div>

  <!-- 로그인 모달 -->
  <div class="auth-section hidden" id="authModal">
    <div class="auth-card">
      <button class="auth-close" id="authClose" aria-label="Close">×</button>
      <div class="auth-title" style="font-weight:800; color:#7c3aed;">Sign in</div>
      <div class="auth-subtitle" style="font-size:13px; color:#9ca3af;">Use your Google account</div>
      <button class="google-login-btn" onclick="handleGoogleLogin && handleGoogleLogin()" style="border:2px solid #e5e7eb; background:white; border-radius:12px; padding:12px 16px; font-weight:600; cursor:pointer;">
        Continue with Google
      </button>
    </div>
  </div>

  <!-- 데이터 -->
  <script defer src="data/daily.js"></script>
  <script defer src="data/drama.js"></script>
  <script defer src="data/travel.js"></script>
  <script defer src="data/dataindex.js"></script>

  <!-- 기능 -->
  <script defer src="js/state.js"></script>
  <script defer src="js/tts.js"></script>
  <script defer src="js/app.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const authModal = document.getElementById("authModal");
      const loginBtn = document.getElementById("loginBtn");

      loginBtn?.addEventListener("click", async () => {
        try {
          const u = (window.firebase?.auth && firebase.auth().currentUser) || null;
          if (u && window.SoriUser?.logout) {
            await window.SoriUser.logout();
          } else {
            authModal?.classList.remove("hidden");
          }
        } catch(e){ console.warn(e); }
      });
      document.getElementById("authClose")?.addEventListener("click", () => {
        authModal?.classList.add("hidden");
      });
    });
  </script>
</body>
</html>
