<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sori - Learn Korean</title>

  <!-- Reset & Theme (내장 변수 정의로 안전하게) -->
  <style>
    :root{
      --bg: #ffffff;
      --bg-grad-a: #f5f3ff;
      --bg-grad-b: #faf5ff;
      --bg-grad-c: #f0f9ff;
      --ink: #222222;
      --ink-dim: #6b7280;
      --brand: #7c3aed;
      --brand-ink: #ffffff;
      --chip: #f3f0ff;
      --chip-ink: #5b21b6;
      --border: #e5e7eb;
      --card: #ffffff;
      --shadow: 0 8px 24px rgba(0,0,0,.06);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,system-ui,sans-serif;
      max-width:720px; margin:0 auto; padding:20px;
      background: linear-gradient(135deg,var(--bg-grad-a) 0%,var(--bg-grad-b) 50%,var(--bg-grad-c) 100%);
      color:var(--ink);
      min-height:100vh;
    }
    h1{font-size:28px; font-weight:800; color:var(--brand); margin:0 0 8px}
    .sub{font-size:13px; color:var(--ink-dim); margin-bottom:16px}

    .topbar{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .badge{font-size:12px; padding:2px 8px; border-radius:999px; background:#ede9fe; color:#5b21b6}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:12px; border:1px solid var(--border);
      background:#fff; color:var(--ink); cursor:pointer; user-select:none;
    }
    .btn.primary{background:var(--brand); color:var(--brand-ink); border:none}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .tabs{display:flex; gap:12px; margin:16px 0 10px}
    .tab{
      flex:1; text-align:center; padding:12px; border-radius:12px;
      background:#efeafd; color:#4c1d95; font-weight:700; cursor:pointer; border:1px solid #e9d8fd;
    }
    .tab.active{background:var(--brand); color:#fff; border-color:var(--brand)}

    .chips{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px}
    .chip{
      padding:8px 12px; border-radius:999px; background:var(--chip);
      color:var(--chip-ink); border:1px solid #e9d5ff; cursor:pointer; font-weight:600;
    }
    .chip.active{background:#5b21b6; color:#fff; border-color:#5b21b6}

    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:28px 20px; margin:12px 0;
    }
    .meaning{color:var(--ink-dim); text-align:center; margin-bottom:4px; font-style:italic}
    .korean{font-size:34px; font-weight:800; text-align:center; margin:8px 0 6px}
    .roman{font-size:15px; color:var(--ink-dim); text-align:center; letter-spacing:.1px}

    .dots{display:flex; gap:8px; justify-content:center; margin:14px 0 6px}
    .dot{width:8px; height:8px; border-radius:50%; background:#e5e7eb}
    .dot.active{background:#7c3aed}

    .listen{margin-top:12px}
    .slider-wrap{display:flex; align-items:center; gap:10px; margin:12px 0 4px}
    .slider{flex:1}
    .tip{font-size:12px; color:#b45309; background:#fff7ed; border:1px solid #ffedd5; padding:8px 10px; border-radius:10px; text-align:center}

    .nav{
      display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px
    }
    .counter{font-size:13px; color:var(--ink-dim); text-align:center; margin:8px 0}

    @media (max-width:420px){
      .korean{font-size:28px}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div>
      <span class="badge">beta</span>
      <h1 style="display:inline-block; margin-left:8px;">Sori</h1>
      <div class="sub">Learn Korean naturally by repeating real sounds</div>
    </div>
    <button class="btn" id="loginBtn" aria-label="Login">Login</button>
  </div>

  <!-- Tabs -->
  <div class="tabs" id="tabs"></div>

  <!-- Subcategory chips -->
  <div class="chips" id="chips"></div>

  <!-- Card -->
  <div class="card">
    <div class="meaning" id="meaning">"Hello"</div>
    <div class="korean" id="korean">안녕하세요.</div>
    <div class="roman" id="roman">annyeonghaseyo</div>

    <div class="dots" id="dots"></div>

    <div class="listen">
      <button class="btn primary" id="speakBtn">Listen &amp; Repeat</button>
      <div class="slider-wrap">
        <div style="font-size:13px; color:var(--ink-dim)">Speed:</div>
        <input id="rate" class="slider" type="range" min="0.5" max="1.25" value="0.9" step="0.05" />
        <div id="rateLbl" style="width:52px; text-align:right; font-size:13px; color:var(--ink-dim)">0.90x</div>
      </div>
      <div class="tip">Tip: Listen carefully and repeat multiple times. Consistency is key.</div>
    </div>

    <div class="nav">
      <button class="btn" id="prevBtn">◀ Previous</button>
      <button class="btn" id="nextBtn">Next ▶</button>
    </div>
    <div class="counter" id="counter">1 / 1</div>
  </div>

  <script>
    // ----------------------------
    // 1) 데이터
    // ----------------------------
    window.SORI_DATA = {
      daily: [
        {t:'Greeting', c:'First meeting', k:'안녕하세요.', e:'Hello', p:'annyeonghaseyo'},
        {t:'Greeting', c:'Casual hi', k:'안녕!', e:'Hi', p:'annyeong'},
        {t:'Greeting', c:'How are you', k:'잘 지냈어요?', e:'Have you been well?', p:'jal jinaesseoyo'},
        {t:'Greeting', c:'Introduce', k:'저는 민우예요.', e:'I am Minwoo.', p:'jeoneun minuyeyo'},

        {t:'Small talk', c:'Thanks', k:'고맙습니다.', e:'Thank you.', p:'gomapseumnida'},
        {t:'Small talk', c:'Sorry', k:'미안해요.', e:'I’m sorry.', p:'mianhaeyo'},
        {t:'Small talk', c:'Please', k:'부탁드립니다.', e:'Please.', p:'butak deurimnida'},
        {t:'Small talk', c:'Excuse me', k:'실례합니다.', e:'Excuse me.', p:'sillyehamnida'},

        {t:'Numbers', c:'Price check', k:'얼마예요?', e:'How much is it?', p:'eolmayeyo'},
        {t:'Numbers', c:'Count to ten', k:'하나, 둘, 셋...', e:'One, two, three…', p:'hana, dul, set'},

        {t:'Time', c:'What time', k:'지금 몇 시예요?', e:'What time is it now?', p:'jigeum myeot siyeyo'},
        {t:'Time', c:'Today', k:'오늘 일정 있어요.', e:'I have plans today.', p:'oneul iljeong isseoyo'}
      ],
      travel: [
        {t:'Cafe', c:'Order coffee', k:'아메리카노 한 잔 주세요.', e:'One Americano, please.', p:'amerikano han jan juseyo'},
        {t:'Cafe', c:'To go', k:'테이크아웃 돼요?', e:'Can I get it to go?', p:'teikeu aut dwaeyo'},
        {t:'Shopping', c:'Different size', k:'다른 사이즈 있어요?', e:'Do you have another size?', p:'dareun saijeu isseoyo'},
        {t:'Shopping', c:'Try on', k:'입어봐도 돼요?', e:'May I try this on?', p:'ibeobwado dwaeyo'},
        {t:'Transport', c:'Subway', k:'지하철 어디로 가요?', e:'Which way is the subway?', p:'jihacheol eodiro gayo'},
        {t:'Hotel', c:'Check in', k:'체크인 하려고 왔어요.', e:'I’d like to check in.', p:'chekeu-in haryeogo wasseoyo'},
        {t:'Restaurant', c:'Recommendation', k:'추천 메뉴가 뭐예요?', e:'What do you recommend?', p:'chucheon menyuga mwoyeyo'},
        {t:'Emergency', c:'Help', k:'도와주세요!', e:'Please help!', p:'dowajuseyo'}
      ],
      drama: [
        {t:'Goblin', c:'Kim Shin', k:'너는, 내가 잃은 모든 날들이다.', e:'You are all the days I lost.', p:'neoneun, naega ireun modeun naldeulida'},
        {t:'Goblin', c:'Eun-tak', k:'혼자였던 시간도, 나를 만들었어.', e:'Even my lonely days shaped me.', p:'honjayotteon sigando, nareul mandeureosseo'},
        {t:'Crash Landing', c:'Ri Jeong-hyeok', k:'널 좋아한 게, 잘못이었을까?', e:'Was it wrong that I liked you?', p:'neol joahan ge, jalmosieosseulkka'},
        {t:'Itaewon Class', c:'Park Sae-ro-yi', k:'내 길은 내가 정한다.', e:'I decide my own path.', p:'nae gireun naega jeonghanda'}
      ]
    };

    // ----------------------------
    // 2) 상태
    // ----------------------------
    const state = {
      tab: 'daily',       // 'daily' | 'travel' | 'drama'
      sub: null,          // 현재 필터 서브카테고리
      idx: 0,             // 현재 문장 인덱스
      rate: 0.9,          // 음성 속도
      koVoice: null       // 한국어 보이스 캐시
    };

    // ----------------------------
    // 3) 유틸
    // ----------------------------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    function getList(){
      const list = window.SORI_DATA[state.tab] || [];
      if(!state.sub) return list;
      return list.filter(x => x.t === state.sub);
    }

    function clampIdx(){
      const list = getList();
      if(list.length === 0){ state.idx = 0; return; }
      if(state.idx >= list.length) state.idx = list.length - 1;
      if(state.idx < 0) state.idx = 0;
    }

    // ----------------------------
    // 4) 렌더
    // ----------------------------
    function renderTabs(){
      const tabs = [
        {key:'daily', label:'Daily'},
        {key:'travel', label:'Travel'},
        {key:'drama', label:'K-Drama'}
      ];
      const el = $('#tabs');
      el.innerHTML = '';
      tabs.forEach(t=>{
        const btn = document.createElement('button');
        btn.className = 'tab' + (state.tab===t.key?' active':'');
        btn.textContent = t.label;
        btn.onclick = ()=>{
          state.tab = t.key; state.sub = null; state.idx = 0;
          renderAll();
        };
        el.appendChild(btn);
      });
    }

    function renderChips(){
      const list = window.SORI_DATA[state.tab] || [];
      const subs = [...new Set(list.map(x=>x.t))];
      const el = $('#chips');
      el.innerHTML = '';
      subs.forEach(s=>{
        const chip = document.createElement('button');
        chip.className = 'chip' + (state.sub===s?' active':'');
        chip.textContent = s;
        chip.onclick = ()=>{
          state.sub = (state.sub===s ? null : s);
          state.idx = 0;
          renderAll();
        };
        el.appendChild(chip);
      });
    }

    function renderCard(){
      const list = getList();
      const empty = {e:'No items', k:'', p:''};
      const item = list[state.idx] || empty;

      $('#meaning').textContent = item.e ? `"${item.e}"` : '';
      $('#korean').textContent = item.k || '';
      $('#roman').textContent  = item.p || '';

      // dots
      const dots = $('#dots');
      dots.innerHTML = '';
      list.forEach((_,i)=>{
        const d = document.createElement('div');
        d.className = 'dot' + (i===state.idx?' active':'');
        d.onclick = ()=>{ state.idx = i; renderCard(); };
        dots.appendChild(d);
      });

      // counter
      $('#counter').textContent = list.length ? `${state.idx+1} / ${list.length}` : '0 / 0';

      // 네비 버튼
      $('#prevBtn').disabled = state.idx<=0 || list.length===0;
      $('#nextBtn').disabled = state.idx>=list.length-1 || list.length===0;
    }

    function renderAll(){
      renderTabs();
      renderChips();
      clampIdx();
      renderCard();
    }

    // ----------------------------
    // 5) 음성 합성
    // ----------------------------
    function pickKoreanVoice(){
      const voices = window.speechSynthesis.getVoices();
      // ko-KR 우선, 없으면 한국어가 들어간 이름, 마지막으로 기본값
      const exact = voices.find(v=>/ko-KR/i.test(v.lang));
      if(exact) return exact;
      const anyKo = voices.find(v=>/korean|ko/i.test(v.name+v.lang));
      return anyKo || voices[0] || null;
    }

    function speakKorean(text){
      if(!('speechSynthesis' in window)) {
        alert('Speech Synthesis not supported on this browser.');
        return;
      }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      state.koVoice = state.koVoice || pickKoreanVoice();
      if(state.koVoice) u.voice = state.koVoice;
      u.lang = (state.koVoice && state.koVoice.lang) || 'ko-KR';
      u.rate = state.rate;
      u.pitch = 1.0;
      window.speechSynthesis.speak(u);
    }

    // ----------------------------
    // 6) 이벤트
    // ----------------------------
    $('#speakBtn').addEventListener('click', ()=>{
      const list = getList();
      if(!list.length) return;
      speakKorean(list[state.idx].k);
    });

    $('#prevBtn').addEventListener('click', ()=>{
      state.idx--; clampIdx(); renderCard();
    });
    $('#nextBtn').addEventListener('click', ()=>{
      state.idx++; clampIdx(); renderCard();
    });

    const rateEl = $('#rate');
    const rateLbl = $('#rateLbl');
    rateEl.addEventListener('input', ()=>{
      state.rate = parseFloat(rateEl.value);
      rateLbl.textContent = state.rate.toFixed(2)+'x';
    });

    // 일부 브라우저는 첫 로드 때 보이스 목록이 비어있다가 event를 나중에 쏜다
    if('speechSynthesis' in window){
      window.speechSynthesis.onvoiceschanged = ()=>{ state.koVoice = pickKoreanVoice(); };
    }

    // 초기 렌더
    renderAll();
  </script>
</body>
</html>
