<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sori - Learn Korean</title>
<style>
  * { box-sizing: border-box; }
  
  body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
    max-width: 680px; 
    margin: 0 auto; 
    padding: 20px;
    background: #faf8ff;
    min-height: 100vh;
  }
  
  h1 { 
    font-size: 32px; 
    margin: 0 0 12px 0; 
    color: #7c3aed;
    font-weight: 800;
  }
  
  .intro {
    color: #9ca3af;
    font-size: 16px;
    margin-bottom: 24px;
    line-height: 1.6;
    font-weight: 500;
  }
  
  .card { 
    border-radius: 24px; 
    padding: 28px; 
    margin: 16px 0; 
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    background: white;
  }
  
  .category-tabs {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }
  
  .tab-button {
    padding: 16px 24px;
    border: 2px solid #f3f4f6;
    border-radius: 20px;
    background: #f9fafb;
    color: #9ca3af;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    transition: all 0.2s;
  }
  
  .tab-button:hover {
    background: #f3f4f6;
  }
  
  .tab-button.active {
    background: #7c3aed;
    color: white;
    border-color: #7c3aed;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
  }
  
  .sub-filters {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
    padding: 16px;
    background: #f9fafb;
    border-radius: 16px;
  }
  
  .filter-chip {
    padding: 8px 16px;
    border-radius: 20px;
    background: white;
    border: 2px solid #e5e7eb;
    color: #6b7280;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
  }
  
  .filter-chip:hover {
    background: #f9fafb;
  }
  
  .filter-chip.active {
    background: #7c3aed;
    color: white;
    border-color: #7c3aed;
  }
  
  .badge {
    display: inline-block;
    background: #7c3aed;
    color: white;
    padding: 8px 16px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 800;
    margin-bottom: 8px;
  }
  
  .context-box {
    background: #f9fafb;
    border-radius: 12px;
    padding: 10px 16px;
    margin-bottom: 20px;
    font-size: 14px;
    color: #6b7280;
    font-weight: 600;
  }
  
  .korean-section {
    background: #f9fafb;
    border-radius: 20px;
    padding: 32px 24px;
    margin: 20px 0;
  }
  
  .target-display {
    font-size: 40px;
    font-weight: 900;
    color: #1f2937;
    text-align: center;
    line-height: 1.4;
    margin-bottom: 16px;
  }
  
  .pronunciation-hint {
    color: #9ca3af;
    font-size: 19px;
    font-weight: 600;
    text-align: center;
    letter-spacing: 0.5px;
    margin-bottom: 20px;
    font-style: italic;
  }
  
  .english-translation {
    color: #9ca3af;
    font-size: 19px;
    text-align: center;
    margin-bottom: 0;
    font-weight: 600;
    font-style: italic;
  }
  
  .pronunciation-section {
    display: none;
  }
  
  button { 
    padding: 18px 28px; 
    border: 0; 
    border-radius: 20px; 
    background: #7c3aed;
    color: white; 
    cursor: pointer; 
    font-size: 18px;
    font-weight: 800;
    width: 100%;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
    transition: all 0.2s;
  }
  
  button:hover {
    background: #6d28d9;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.25);
  }
  
  button:disabled { 
    opacity: 0.4;
    cursor: not-allowed;
  }
  
  button.secondary {
    background: #f9fafb;
    color: #6b7280;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }
  
  button.secondary:hover {
    background: #f3f4f6;
  }
  
  .button-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 16px;
  }
  
  .practice-tip {
    background: #fffbeb;
    border-left: 4px solid #f59e0b;
    padding: 16px 20px;
    border-radius: 16px;
    margin-top: 20px;
    font-size: 14px;
    color: #92400e;
    line-height: 1.7;
    font-weight: 500;
  }
  
  .progress {
    text-align: center;
    color: #7c3aed;
    font-size: 15px;
    font-weight: 700;
    margin-top: 12px;
  }
  
  .voice-speed {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 16px;
    padding: 12px;
    background: #f9fafb;
    border-radius: 12px;
  }
  
  .voice-speed label {
    color: #6b7280;
    font-size: 14px;
    font-weight: 600;
  }
  
  .voice-speed input { 
    width: 150px;
    cursor: pointer;
  }
  
  .voice-speed span {
    color: #6b7280;
    font-weight: 700;
    font-size: 14px;
    min-width: 60px;
  }
  
  .error-msg {
    background: #fee2e2;
    color: #991b1b;
    padding: 12px 16px;
    border-radius: 12px;
    margin-top: 12px;
    font-size: 13px;
    font-weight: 600;
    display: none;
  }
  
  @media (max-width: 640px) {
    body { padding: 16px; }
    h1 { font-size: 28px; }
    .card { padding: 24px; }
    .target-display { font-size: 34px; }
    .pronunciation-hint { font-size: 19px; }
    .category-tabs {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <h1>Sori - Learn Korean</h1>
  <div class="intro">Master Korean with K-Drama lines and daily conversations üíï</div>

  <div class="card">
    <div class="category-tabs">
      <button class="tab-button" id="dailyBtn">üí¨ Daily</button>
      <button class="tab-button" id="travelBtn">‚úàÔ∏è Travel</button>
      <button class="tab-button active" id="dramaBtn">üé≠ K-Drama</button>
    </div>
    
    <div id="subFilters" style="display:none;"></div>
  </div>

  <div class="card">
    <div class="badge" id="badge">Goblin</div>
    <div class="context-box" id="context">Conversation: Kim Shin to Eun-tak</div>
    
    <div class="korean-section">
      <div class="target-display" id="korean">ÎÑàÎäî ÎÇ¥Í∞Ä ÏûÉÏùÄ Î™®Îì† ÎÇ†Îì§Ïù¥Îã§</div>
      <div class="pronunciation-hint" id="pronunciation">neoneun naega ireun modeun naldeulida</div>
      <div class="english-translation" id="english">"You are all the days I lost"</div>
    </div>
    
    <button id="playBtn">üîä Listen & Repeat</button>
    <div class="error-msg" id="errorMsg"></div>
    
    <div class="voice-speed">
      <label>Speed:</label>
      <input type="range" id="speed" min="0.6" max="1.0" step="0.1" value="0.75">
      <span id="speedTxt">0.75x</span>
    </div>
    
    <div class="practice-tip">
      üí° <strong>Tip:</strong> Listen carefully and repeat multiple times. Consistency is key!
    </div>
  </div>

  <div class="card">
    <div class="button-group">
      <button class="secondary" id="prevBtn">‚óÄ Previous</button>
      <button class="secondary" id="nextBtn">‚ñ∂ Next</button>
    </div>
    <div class="progress" id="prog">1 / 67</div>
  </div>

<script>
const drama = [
  {t:'Goblin',c:'Kim Shin to Eun-tak',k:'ÎÑàÎäî, ÎÇ¥Í∞Ä ÏûÉÏùÄ Î™®Îì† ÎÇ†Îì§Ïù¥Îã§.',e:'You are all the days I lost',p:'neoneun, naega ireun modeun naldeulida',sub:'Goblin'},
  {t:'Goblin',c:'Eun-tak reflection',k:'ÌòºÏûêÏòÄÎçò ÏãúÍ∞ÑÎèÑ, ÎÇòÎ•º ÎßåÎì§ÏóàÏñ¥.',e:'Even my lonely days shaped me',p:'honjayotteon sigando, nareul mandeureosseo',sub:'Goblin'},
  {t:'Crash Landing on You',c:'Ri Jeong-hyeok',k:'ÎÑê Ï¢ãÏïÑÌïú Í≤å, ÏûòÎ™ªÏù¥ÏóàÏùÑÍπå?',e:'Was it wrong that I liked you?',p:'neol joahan ge, jalmosieosseulkka',sub:'Crash Landing'},
  {t:'Crash Landing on You',c:'Yoon Se-ri',k:'ÎÅùÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïú ÏàúÍ∞Ñ, Îã§Ïãú ÏãúÏûëÎêêÏñ¥.',e:'When I thought it was over it began again',p:'kkeutirago saenggakan sungan, dasi sijakdwaesseo',sub:'Crash Landing'},
  {t:'Itaewon Class',c:'Park Sae-ro-yi',k:'ÎÇòÎäî, ÎÇ¥ Î∞©ÏãùÎåÄÎ°ú Í∞ÑÎã§.',e:'I go my own way',p:'naneun, nae bangsikdaero ganda',sub:'Itaewon'},
  {t:'SKY Castle',c:'Kang Ye-seo',k:'Ïà® Ï¢Ä Ïâ¨Í≤å Ìï¥Ï§ò.',e:'Let me breathe, please',p:'sum jom swige haejwo',sub:'SKY Castle'},
  {t:'Descendants of the Sun',c:'Yoo Si-jin',k:'Î∂ÄÎ•¥Î©¥ Í∞ÄÍ≥†, Ïïà Î∂ÄÎ•¥Î©¥ Ïïà Í∞Ä.',e:'If you call I go if not I stay',p:'bureumyeon gago, an bureumyeon an ga',sub:'Descendants'},
  {t:'My Love from the Star',c:'Cheon Song-yi',k:'Ï≤´Îàà Ïò§Îäî ÎÇ†Ïóî, Ïö©Í∏∞Í∞Ä ÌïÑÏöîÌï¥.',e:'On the first snow you need courage',p:'cheotnun oneun naren, yonggiga piryohae',sub:'My Love'},
  {t:'Mr. Sunshine',c:'Go Ae-shin',k:'Ïä¨Ìîà ÎÇ†Ïóî, ÎÇ¥ Ïñ¥Íπ® ÎπåÎ†§Ï§ÑÍ≤åÏöî.',e:'On sad days you can lean on my shoulder',p:'seulpeun naren, nae eokkae billyeojulgeyo',sub:'Mr. Sunshine'},
  {t:'Reply 1988',c:'Deok-sun',k:'Ïò§ÎäòÎèÑ ÌååÏù¥ÌåÖ!',e:'Fighting for today',p:'oneuldo paiting',sub:'Reply 1988'},
  {t:'Hospital Playlist',c:'Ik-jun',k:'Î∞•ÏùÄ Íº≠ Ï±ôÍ≤® Î®πÏñ¥.',e:'Remember to eat your meals',p:'babeun kkok chaenggyeo meogeo',sub:'Hospital'},
  {t:'Extraordinary Attorney Woo',c:'Woo Young-woo',k:'Í∏∞Îü¨Í∏∞, ÌÜ†ÎßàÌÜ†, Ïä§ÏúÑÏä§, Ïù∏ÎèÑÏù∏.',e:'Palindrome wordplay',p:'girugi, tomato, seuwiseu, indoin',sub:'Attorney Woo'},
  {t:'Twenty Five Twenty One',c:'Na Hee-do',k:'ÏßÄÍ∏à Ïù¥ ÏàúÍ∞ÑÏù¥, Ï†ÑÎ∂ÄÏïº.',e:'This moment is everything',p:'jigeum i sungani, jeonbuya',sub:'Twenty Five'},
  {t:'D.P.',c:'Jun-ho',k:'Í¥úÏ∞ÆÏïÑ. Î≤ÑÌã∏ Ïàò ÏûàÏñ¥.',e:'It is okay we can endure',p:'gwaenchana. beotil su isseo',sub:'D.P.'},
  {t:'Signal',c:'Detective',k:'Ìè¨Í∏∞ÌïòÎ©¥, Í±∞Í∏∞ÏÑú ÎÅùÏù¥Ïïº.',e:'If you give up it ends there',p:'pogihamyeon, geogiseo kkeusiya',sub:'Signal'},
  {t:'Our Blues',c:'Mother',k:'Ï≤úÏ≤úÌûà Ìï¥ÎèÑ, Í¥úÏ∞ÆÏïÑ.',e:'It is okay to go slow',p:'cheoncheonhi haedo, gwaenchana',sub:'Our Blues'},
  {t:'Hometown Cha Cha Cha',c:'Hong Du-sik',k:'ÎãµÏùÄ Îäò, Í∞ÄÍπåÏù¥Ïóê ÏûàÏñ¥.',e:'The answer is always close by',p:'dabeun neul, gakkaie isseo',sub:'Hometown'},
  {t:'Misaeng',c:'Manager Oh',k:'ÏûëÏùÄ ÏÑ±Ïã§Ïù¥, ÌÅ∞ Î≥ÄÌôîÎ•º ÎßåÎì†Îã§.',e:'Small diligence makes big change',p:'jageun seongsiri, keun byeonhwareul mandeunda',sub:'Misaeng'}
];

const daily = [
  {t:'Greeting',c:'First meeting',k:'ÏïàÎÖïÌïòÏÑ∏Ïöî.',e:'Hello',p:'annyeonghaseyo',sub:'Greeting'},
  {t:'Greeting',c:'Casual hi',k:'ÏïàÎÖï!',e:'Hi',p:'annyeong',sub:'Greeting'},
  {t:'Greeting',c:'Long time',k:'Ïò§ÎûúÎßåÏù¥ÏóêÏöî!',e:'Long time no see!',p:'oraenmanieyo',sub:'Greeting'},
  {t:'Greeting',c:'How are you',k:'Ïûò ÏßÄÎÉàÏñ¥Ïöî?',e:'Have you been well?',p:'jal jinaesseoyo',sub:'Greeting'},
  {t:'Greeting',c:'Introduction',k:'Ï†ÄÎäî ÎØºÏö∞ÏòàÏöî.',e:'I am Minwoo',p:'jeoneun minuyeyo',sub:'Greeting'},
  {t:'Cafe',c:'Order',k:'ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ Ìïú Ïûî, Ï£ºÏÑ∏Ïöî.',e:'One americano, please',p:'amerikano han jan, juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Size',k:'ÎùºÏßÄÎ°ú Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.',e:'Large, please',p:'rajiro butakdeurimnida',sub:'Cafe'},
  {t:'Cafe',c:'To go',k:'Ìè¨Ïû•Ìï†Í≤åÏöî.',e:'To go, please',p:'pojanghalgeyo',sub:'Cafe'},
  {t:'Cafe',c:'No ice',k:'ÏñºÏùåÏùÄ Îπº Ï£ºÏÑ∏Ïöî.',e:'No ice, please',p:'eoreumeun ppae juseyo',sub:'Cafe'},
  {t:'Cafe',c:'Compliment',k:'Ïª§ÌîºÍ∞Ä Ï†ïÎßê ÎßõÏûàÎÑ§Ïöî!',e:'The coffee is really good',p:'keopiga jeongmal masinneyo',sub:'Cafe'},
  {t:'Restaurant',c:'Table',k:'Îëê Î™ÖÏù¥ÏóêÏöî.',e:'Table for two',p:'du myeongieyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Recommendation',k:'Ï∂îÏ≤ú Î©îÎâ¥Í∞Ä ÏûàÎÇòÏöî?',e:'Do you have a recommendation?',p:'chucheon menyuga innayo',sub:'Restaurant'},
  {t:'Restaurant',c:'Not spicy',k:'Ïïà Îß§Ïö¥ Í±∏Î°ú, Ï£ºÏÑ∏Ïöî.',e:'Not spicy, please',p:'an maeun geollo, juseyo',sub:'Restaurant'},
  {t:'Restaurant',c:'More water',k:'Î¨º Ï¢Ä Îçî Ï£ºÏãúÍ≤†Ïñ¥Ïöî?',e:'Could I get more water?',p:'mul jom deo jusigesseoyo',sub:'Restaurant'},
  {t:'Restaurant',c:'Check',k:'Í≥ÑÏÇ∞ÏÑú Î∂ÄÌÉÅÎìúÎ†§Ïöî.',e:'Check, please',p:'gyesanseo butakdeuryeoyo',sub:'Restaurant'},
  {t:'Shopping',c:'Price',k:'ÏñºÎßàÏòàÏöî?',e:'How much is it?',p:'eolmayeyo',sub:'Shopping'},
  {t:'Shopping',c:'Try on',k:'ÏûÖÏñ¥Î¥êÎèÑ Îê†ÍπåÏöî?',e:'May I try this on?',p:'ibeobwado doelkkayo',sub:'Shopping'},
  {t:'Shopping',c:'Other color',k:'Îã§Î•∏ ÏÉâ, ÏûàÏñ¥Ïöî?',e:'Do you have another color?',p:'dareun saek, isseoyo',sub:'Shopping'},
  {t:'Shopping',c:'Discount',k:'Ìï†Ïù∏ Í∞ÄÎä•Ìï†ÍπåÏöî?',e:'Is a discount possible?',p:'halin ganeunhalkkayo',sub:'Shopping'},
  {t:'Shopping',c:'Card payment',k:'Ïπ¥ÎìúÎ°ú Í≤∞Ï†úÌï†Í≤åÏöî.',e:'I will pay by card',p:'kadeuro gyeoljehalgeyo',sub:'Shopping'},
  {t:'Health',c:'Headache',k:'Î®∏Î¶¨Í∞Ä ÏïÑÌååÏöî.',e:'I have a headache',p:'meoriga apayo',sub:'Health'},
  {t:'Health',c:'Cold medicine',k:'Í∞êÍ∏∞ÏïΩ, ÏûàÏñ¥Ïöî?',e:'Do you have cold medicine?',p:'gamgiyak, isseoyo',sub:'Health'},
  {t:'Health',c:'Allergy',k:'ÎïÖÏΩ© ÏïåÎ†àÎ•¥Í∏∞Í∞Ä ÏûàÏñ¥Ïöî.',e:'I have a peanut allergy',p:'ttangkong allerugiga isseoyo',sub:'Health'},
  {t:'Health',c:'Where hurts',k:'Ïñ¥ÎîîÍ∞Ä ÏïÑÌîÑÏÑ∏Ïöî?',e:'Where does it hurt?',p:'eodiga apeuseyo',sub:'Health'},
  {t:'Health',c:'After meals',k:'ÏãùÌõÑÏóê ÎìúÏÑ∏Ïöî.',e:'Take it after meals',p:'sikhue deuseyo',sub:'Health'},
  {t:'Social',c:'Compliment',k:'Ï†ïÎßê ÏûòÌïòÏãúÎÑ§Ïöî!',e:'You are really good!',p:'jeongmal jalhasineyo',sub:'Social'},
  {t:'Social',c:'Movie invite',k:'Í∞ôÏù¥ ÏòÅÌôî Î≥¥Îü¨ Í∞àÎûòÏöî?',e:'Do you want to see a movie?',p:'gachi yeonghwa boreo gallaeyo',sub:'Social'},
  {t:'Social',c:'Decline',k:'ÎØ∏ÏïàÌïòÏßÄÎßå, Ïò§ÎäòÏùÄ Ïñ¥Î†§ÏõåÏöî.',e:'Sorry, but today is difficult',p:'mianhajiman, oneureun eoryeowoyo',sub:'Social'},
  {t:'Social',c:'Tomorrow',k:'ÎÇ¥Ïùº ÏãúÍ∞Ñ, Í¥úÏ∞ÆÏúºÏÑ∏Ïöî?',e:'Are you free tomorrow?',p:'naeil sigan, gwaenchanseuseyo',sub:'Social'},
  {t:'Social',c:'Thank you',k:'ÎèÑÏôÄÏ£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§.',e:'Thank you for your help',p:'dowajusyeoseo gamsahamnida',sub:'Social'}
];

const travel = [
  {t:'Airport',c:'Tourism',k:'Í¥ÄÍ¥ëÌïòÎü¨ ÏôîÏäµÎãàÎã§.',e:'I am here for tourism',p:'gwangwanghareo wasseumnida',sub:'Airport'},
  {t:'Airport',c:'One week',k:'ÏùºÏ£ºÏùº Î®∏Î¨º ÏòàÏ†ïÏûÖÎãàÎã§.',e:'I will stay for one week',p:'iljuil meomul yejeongimnida',sub:'Airport'},
  {t:'Airport',c:'Lost baggage',k:'ÏàòÌïòÎ¨ºÏù¥ Ïïà ÎÇòÏôîÏñ¥Ïöî.',e:'My baggage did not come out',p:'suhamuri an nawasseoyo',sub:'Airport'},
  {t:'Airport',c:'Airport bus',k:'Í≥µÌï≠Î≤ÑÏä§Îäî Ïñ¥ÎîîÏóêÏÑú ÌÉÄÏöî?',e:'Where do I take the airport bus?',p:'gonghang beoseuneun eodieseo tayo',sub:'Airport'},
  {t:'Airport',c:'Exchange',k:'ÌôòÏ†ÑÏùÄ Ïñ¥ÎîîÏÑú Ìï¥Ïöî?',e:'Where can I exchange money?',p:'hwanjeoneun eodiseo haeyo',sub:'Airport'},
  {t:'Hotel',c:'Check in',k:'ÏòàÏïΩÌñàÏñ¥Ïöî. Ï≤¥ÌÅ¨Ïù∏ ÌïòÍ≥† Ïã∂Ïñ¥Ïöî.',e:'I have a reservation. I want to check in',p:'yeyakhaesseoyo. chekeuinhago sipeoyo',sub:'Hotel'},
  {t:'Hotel',c:'WiFi',k:'ÏôÄÏù¥ÌååÏù¥ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≠êÏòàÏöî?',e:'What is the WiFi password?',p:'waipai bimilbeonhoga mwoyeyo',sub:'Hotel'},
  {t:'Hotel',c:'Towels',k:'ÏàòÍ±¥ÏùÑ Îçî Í∞ÄÏ†∏Îã§ Ï£ºÏÑ∏Ïöî.',e:'Please bring more towels',p:'sugeoneul deo gajyeoda juseyo',sub:'Hotel'},
  {t:'Hotel',c:'No hot water',k:'Ïò®ÏàòÍ∞Ä ÎÇòÏò§ÏßÄ ÏïäÏïÑÏöî.',e:'There is no hot water',p:'onsuga naoji anayo',sub:'Hotel'},
  {t:'Hotel',c:'Check out',k:'Ï≤¥ÌÅ¨ÏïÑÏõÉÏùÄ Î™á ÏãúÏòàÏöî?',e:'What time is check out?',p:'chekeuauseun myeot siyeyo',sub:'Hotel'},
  {t:'Transport',c:'Subway',k:'ÏßÄÌïòÏ≤†Ïó≠Ïù¥ Ïñ¥ÎîîÏòàÏöî?',e:'Where is the subway station?',p:'jihacheol yeogi eodiyeyo',sub:'Transport'},
  {t:'Transport',c:'Direction',k:'Ïù¥Ï™ΩÏúºÎ°ú Ï≠â Í∞ÄÏÑ∏Ïöî.',e:'Go straight this way',p:'ijjogeuro jjuk gaseyo',sub:'Transport'},
  {t:'Transport',c:'Transfer',k:'Ïó¨Í∏∞ÏÑú Í∞àÏïÑÌÉÄÏïº Ìï¥Ïöî.',e:'I need to transfer here',p:'yeogiseo garataya haeyo',sub:'Transport'},
  {t:'Transport',c:'Last train',k:'ÎßâÏ∞®Í∞Ä Î™á ÏãúÏòàÏöî?',e:'What time is the last train?',p:'makchaga myeot siyeyo',sub:'Transport'},
  {t:'Transport',c:'Top up card',k:'ÍµêÌÜµÏπ¥Îìú Ï∂©Ï†ÑÌïòÍ≥† Ïã∂Ïñ¥Ïöî.',e:'I want to top up my transit card',p:'gyotong kadeu chungjeonhago sipeoyo',sub:'Transport'},
  {t:'Emergency',c:'Help',k:'ÎèÑÏôÄÏ£ºÏÑ∏Ïöî!',e:'Please help me!',p:'dowajuseyo',sub:'Emergency'},
  {t:'Emergency',c:'Police',k:'Í≤ΩÏ∞∞ÏùÑ Î∂àÎü¨ Ï£ºÏÑ∏Ïöî.',e:'Call the police, please',p:'gyeongchareul bulleo juseyo',sub:'Emergency'},
  {t:'Emergency',c:'Hospital',k:'Î≥ëÏõêÏóê Í∞ÄÏïº Ìï¥Ïöî.',e:'I need to go to a hospital',p:'byeongwone gaya haeyo',sub:'Emergency'},
  {t:'Emergency',c:'Lost wallet',k:'ÏßÄÍ∞ëÏùÑ ÏûÉÏñ¥Î≤ÑÎ†∏Ïñ¥Ïöî.',e:'I lost my wallet',p:'jigabeul ileobeoryeosseoyo',sub:'Emergency'},
  {t:'Emergency',c:'Lost',k:'Í∏∏ÏùÑ ÏûÉÏóàÏñ¥Ïöî.',e:'I am lost',p:'gireul ilheosseoyo',sub:'Emergency'}
];

const subCategories = {
  daily: ['Greeting', 'Cafe', 'Restaurant', 'Shopping', 'Health', 'Social'],
  travel: ['Airport', 'Hotel', 'Transport', 'Emergency']
};

const subIcons = {
  'Greeting': 'üëã', 'Cafe': '‚òï', 'Restaurant': 'üçΩÔ∏è', 'Shopping': 'üõçÔ∏è', 
  'Health': 'üíä', 'Social': 'üë•', 'Airport': '‚úàÔ∏è', 'Hotel': 'üè®', 
  'Transport': 'üöá', 'Emergency': 'üÜò'
};

let st = { cat:'drama', sub:null, i:0, spd:0.75, lines:drama, filteredLines:drama };

function getLines() {
  let base = st.cat === 'drama' ? drama : st.cat === 'daily' ? daily : travel;
  if (st.sub) {
    return base.filter(item => item.sub === st.sub);
  }
  return base;
}

function updateSubFilters() {
  const container = document.getElementById('subFilters');
  
  if (st.cat === 'drama') {
    container.style.display = 'none';
    return;
  }
  
  container.style.display = 'block';
  const cats = subCategories[st.cat] || [];
  
  container.innerHTML = '<div class="sub-filters">' +
    '<div class="filter-chip ' + (!st.sub ? 'active' : '') + '" onclick="filterSub(null)">All</div>' +
    cats.map(cat => 
      '<div class="filter-chip ' + (st.sub === cat ? 'active' : '') + '" onclick="filterSub(\'' + cat + '\')">' +
      subIcons[cat] + ' ' + cat +
      '</div>'
    ).join('') +
    '</div>';
}

function filterSub(sub) {
  st.sub = sub;
  st.i = 0;
  st.filteredLines = getLines();
  updateSubFilters();
  show();
}

function show() {
  st.filteredLines = getLines();
  
  if (st.filteredLines.length === 0) {
    st.filteredLines = st.cat === 'drama' ? drama : st.cat === 'daily' ? daily : travel;
    st.i = 0;
  }
  
  if (st.i >= st.filteredLines.length) st.i = 0;
  if (st.i < 0) st.i = 0;
  
  const d = st.filteredLines[st.i];
  document.getElementById('badge').textContent = d.t;
  document.getElementById('context').textContent = 'Conversation: ' + d.c;
  document.getElementById('korean').textContent = d.k;
  document.getElementById('pronunciation').textContent = d.p;
  document.getElementById('english').textContent = '"' + d.e + '"';
  document.getElementById('prog').textContent = (st.i+1) + ' / ' + st.filteredLines.length;
}

function showError(msg) {
  const err = document.getElementById('errorMsg');
  err.textContent = msg;
  err.style.display = 'block';
  setTimeout(() => { err.style.display = 'none'; }, 5000);
}

function play() {
  const txt = st.filteredLines[st.i].k;
  
  if (!('speechSynthesis' in window)) {
    showError('‚ö†Ô∏è Your browser does not support text-to-speech. Try Chrome, Safari, or Edge.');
    return;
  }
  
  const synth = window.speechSynthesis;
  synth.cancel();
  
  let voices = synth.getVoices();
  if (voices.length === 0) {
    synth.onvoiceschanged = () => {
      voices = synth.getVoices();
      speakText(txt, voices);
    };
  } else {
    speakText(txt, voices);
  }
}

function speakText(txt, voices) {
  const synth = window.speechSynthesis;
  
  setTimeout(() => {
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = 'ko-KR';
    u.rate = st.spd;
    u.pitch = 1.0;
    u.volume = 1.0;
    
    const koVoice = voices.find(v => 
      v.lang && (
        v.lang === 'ko-KR' || 
        v.lang === 'ko_KR' || 
        v.lang.startsWith('ko-') ||
        v.name.includes('Korean') ||
        v.name.includes('ÌïúÍµ≠')
      )
    );
    
    if (koVoice) {
      u.voice = koVoice;
      console.log('Using Korean voice:', koVoice.name);
    } else {
      console.log('No Korean voice found, using default');
    }
    
    u.onerror = (e) => {
      console.error('Speech error:', e);
      showError('‚ö†Ô∏è Speech failed. Please try again.');
    };
    
    u.onend = () => {
      console.log('Speech completed');
    };
    
    synth.speak(u);
  }, 200);
}

function prev() {
  if (st.i > 0) { 
    st.i--; 
    show(); 
  }
}

function next() {
  if (st.i < st.filteredLines.length - 1) { 
    st.i++; 
    show(); 
  }
}

function switchCategory(cat) {
  st.cat = cat;
  st.sub = null;
  st.i = 0;
  
  document.getElementById('dramaBtn').classList.remove('active');
  document.getElementById('dailyBtn').classList.remove('active');
  document.getElementById('travelBtn').classList.remove('active');
  
  if (cat === 'drama') {
    document.getElementById('dramaBtn').classList.add('active');
  } else if (cat === 'daily') {
    document.getElementById('dailyBtn').classList.add('active');
  } else if (cat === 'travel') {
    document.getElementById('travelBtn').classList.add('active');
  }
  
  updateSubFilters();
  show();
}

// Event listeners
document.getElementById('dramaBtn').addEventListener('click', () => switchCategory('drama'));
document.getElementById('dailyBtn').addEventListener('click', () => switchCategory('daily'));
document.getElementById('travelBtn').addEventListener('click', () => switchCategory('travel'));
document.getElementById('playBtn').addEventListener('click', play);
document.getElementById('prevBtn').addEventListener('click', prev);
document.getElementById('nextBtn').addEventListener('click', next);

document.getElementById('speed').addEventListener('input', (e) => {
  st.spd = parseFloat(e.target.value);
  document.getElementById('speedTxt').textContent = st.spd + 'x';
});

// Initialize
show();
</script>
</body>
</html>