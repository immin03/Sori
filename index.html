<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sori - Learn Korean</title>

  <!-- (선택) Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X1909BBKR5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-X1909BBKR5');
  </script>

  <!-- Firebase compat (state.js가 compat 기준) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    *{ box-sizing:border-box }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      max-width:680px;margin:0 auto;padding:12px;background:#faf8ff;min-height:100vh
    }
    h1{font-size:24px;margin:0 0 4px;color:#7c3aed;font-weight:800}
    .intro{color:#9ca3af;font-size:12px;margin-bottom:10px;line-height:1.3;font-weight:500}

    /* header */
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .top-btn{padding:6px 12px;border-radius:10px;font-size:12px;font-weight:700;border:0;cursor:pointer}
    .top-btn.primary{background:#7c3aed;color:#fff}

    /* cards/tabs */
    .card{background:#fff;border-radius:16px;padding:16px;margin:8px 0;box-shadow:0 2px 12px rgba(0,0,0,.05)}
    .category-tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
    .tab-button{padding:10px 14px;border:2px solid #f3f4f6;border-radius:14px;background:#f9fafb;color:#9ca3af;font-size:13px;font-weight:700;cursor:pointer;transition:.2s}
    .tab-button:hover{background:#f3f4f6}
    .tab-button.active{background:#7c3aed;color:#fff;border-color:#7c3aed;box-shadow:0 2px 8px rgba(124,58,237,.2)}
    .sub-filters{display:none;margin-top:8px}

    /* badge / star */
    .row-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .badge{display:inline-block;background:#7c3aed;color:#fff;font-size:11px;font-weight:800;padding:5px 10px;border-radius:10px}
    .icon-btn{border:none;background:transparent;width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center;font-size:20px;line-height:1;color:#9ca3af;cursor:pointer;border-radius:8px}
    .icon-btn:hover{background:#f3f4f6}
    .icon-btn.active{color:#d97706}

    .context{background:#f9fafb;border-radius:8px;padding:6px 10px;margin-top:8px;color:#6b7280;font-size:12px;font-weight:600}

    /* main text */
    .kbox{background:#f9fafb;border-radius:14px;padding:16px 12px;margin:12px 0}
    .ko{font-size:28px;font-weight:900;color:#1f2937;text-align:center;margin:0 0 6px}
    .en{color:#6b7280;font-size:16px;text-align:center;margin:0 0 10px;font-weight:600}
    .pr{color:#9ca3af;font-size:13px;font-style:italic;text-align:center;margin:0}

    /* practice */
    .practice{background:#f9fafb;border-radius:10px;padding:10px}
    .practice-label{font-size:12px;font-weight:600;color:#6b7280;text-align:center;margin:0 0 8px}
    .dots{display:flex;gap:6px;justify-content:center;margin-bottom:8px}
    .rep-dot{width:32px;height:32px;border-radius:50%;border:2px solid #e5e7eb;background:#fff;display:flex;align-items:center;justify-content:center}
    .rep-dot.completed{background:#7c3aed;border-color:#7c3aed}

    /* buttons */
    button.big{width:100%;padding:12px 18px;border-radius:14px;border:0;cursor:pointer;font-weight:800;font-size:15px;background:#7c3aed;color:#fff;box-shadow:0 2px 8px rgba(124,58,237,.2)}
    button.big:hover{background:#6d28d9}
    .error{display:none;background:#fee2e2;color:#991b1b;font-size:11px;font-weight:600;padding:8px 12px;border-radius:8px;margin-top:8px}

    .row{display:flex;align-items:center;justify-content:center;gap:8px;background:#f9fafb;border-radius:8px;padding:8px;margin-top:8px}
    .row label{color:#7c3aed;font-size:12px;font-weight:600}
    .row span{color:#7c3aed;font-size:12px;font-weight:700;min-width:42px;text-align:right}

    .nav{display:grid;grid-template-columns:1fr 1fr;gap:6px}
    .secondary{background:#f9fafb;color:#6b7280;border:0;padding:12px 18px;border-radius:14px;font-weight:800}
    .secondary:hover{background:#f3f4f6}
    .progress{text-align:center;color:#7c3aed;font-size:13px;font-weight:700;margin-top:8px}

    .cong{display:none;margin:8px 0;text-align:center;background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);border-radius:10px;padding:12px}
    .cong.show{display:block}

    /* auth modal */
    .auth{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);align-items:center;justify-content:center;z-index:9999;padding:16px}
    .auth:not(.hidden){display:flex}
    .auth-card{background:#fff;width:100%;max-width:360px;border-radius:18px;padding:24px;box-shadow:0 18px 50px rgba(0,0,0,.35);text-align:center;position:relative}
    .auth-close{position:absolute;top:10px;right:10px;background:none;border:none;font-size:22px;color:#9ca3af;cursor:pointer}

    @media (max-width:640px){ .category-tabs{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div>
      <h1>Sori <span style="font-size:14px;color:#9ca3af;font-weight:600;">(beta)</span></h1>
      <div class="intro">Master Korean with K-Drama lines and daily conversations</div>
    </div>
    <div>
      <button id="loginBtn" class="top-btn primary">Login</button>
    </div>
  </header>

  <!-- TABS -->
  <section class="card">
    <div class="category-tabs">
      <button id="dailyBtn"  class="tab-button active">Daily</button>
      <button id="travelBtn" class="tab-button">Travel</button>
      <button id="dramaBtn"  class="tab-button">K-Drama</button>
      <button id="savedBtn"  class="tab-button">★ Saved</button>
    </div>
    <div id="subFilters" class="sub-filters"></div>
  </section>

  <!-- LESSON -->
  <section class="card">
    <div class="row-between">
      <div id="badge" class="badge">Greeting</div>
      <button id="scrapBtn" class="icon-btn" title="Save this phrase" aria-label="Save">☆</button>
    </div>

    <div id="context" class="context">Conversation: First meeting</div>

    <div class="kbox">
      <p id="korean" class="ko">안녕하세요.</p>
      <p id="english" class="en">"Hello"</p>
      <p id="pronunciation" class="pr">annyeonghaseyo</p>
    </div>

    <div class="practice">
      <p class="practice-label">Practice Count: <span id="repCount">0</span> / 5</p>
      <div class="dots">
        <div class="rep-dot"></div>
        <div class="rep-dot"></div>
        <div class="rep-dot"></div>
        <div class="rep-dot"></div>
        <div class="rep-dot"></div>
      </div>
    </div>

    <div id="congrats" class="cong">🎉 Great job!</div>

    <button id="playBtn" class="big">Listen & Repeat</button>
    <div id="errorMsg" class="error"></div>

    <div class="row">
      <label for="speed">Speed:</label>
      <input id="speed" type="range" min="0.3" max="1.0" step="0.1" value="0.75" />
      <span id="speedTxt">0.75x</span>
    </div>

    <div class="card" style="margin-top:10px; background:#fffbeb; border-left:3px solid #f59e0b;">
      <div style="font-size:12px; color:#92400e; font-weight:500;">
        Tip: Listen carefully and repeat multiple times. Consistency is key.
      </div>
    </div>
  </section>

  <!-- NAV -->
  <section class="card">
    <div class="nav">
      <button id="prevBtn" class="secondary">◀ Previous</button>
      <button id="nextBtn" class="secondary">▶ Next</button>
    </div>
    <div id="prog" class="progress">1 / 30</div>
  </section>

  <!-- AUTH MODAL -->
  <div id="authModal" class="auth hidden">
    <div class="auth-card">
      <button id="authClose" class="auth-close" aria-label="Close">×</button>
      <div style="font-size:24px;font-weight:800;color:#7c3aed;margin-bottom:6px;">Sign in</div>
      <div style="font-size:13px;color:#9ca3af;margin-bottom:18px;">Use your Google account</div>
      <button class="gbtn" onclick="window.handleGoogleLogin && window.handleGoogleLogin()">Continue with Google</button>
    </div>
  </div>

  <!-- DATA (무조건 앱 로직보다 먼저) -->
  <script defer src="data/daily.js?v=20251017"></script>
  <script defer src="data/travel.js?v=20251017"></script>
  <script defer src="data/drama.js?v=20251017"></script>
  <script defer src="data/dataindex.js?v=20251017"></script>

  <!-- APP SCRIPTS (순서 중요: state -> tts -> app) -->
  <script defer src="js/state.js?v=20251017"></script>
  <script defer src="js/tts.js?v=20251017"></script>
  <script defer src="js/app.js?v=20251017"></script>

  <!-- 헤더: 로그인/모달만 -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('authModal');
      const loginBtn = document.getElementById('loginBtn');

      loginBtn?.addEventListener('click', async () => {
        try {
          const u = (window.firebase?.auth && firebase.auth().currentUser) || null;
          if (u && window.SoriUser?.logout) {
            await window.SoriUser.logout();
          } else {
            modal?.classList.remove('hidden');
          }
        } catch (e) { console.warn(e); }
      });

      document.getElementById('authClose')?.addEventListener('click', () => {
        modal?.classList.add('hidden');
      });
    });
  </script>
</body>
</html>
